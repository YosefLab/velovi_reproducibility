

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Uncertainty analysis - Pancreas &#8212; VeloVI Reproducibility</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'uncertainty/pancreas_noise';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Uncertainty analysis - Dentate gyrus" href="../case_studies/dentategyrus.html" />
    <link rel="prev" title="Uncertainty analysis - Pancreas" href="pancreas.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    <p class="title logo__title">VeloVI Reproducibility</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Intro
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Estimation Comparison</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../estimation_comparison/simulated.html">Inference comparison on simulated data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../estimation_comparison/simulation_w_inferred_rates.html">Comparison of inferred velocity and latent times</a></li>
<li class="toctree-l1"><a class="reference internal" href="../estimation_comparison/sceu.html">Comparison of velocities between EM and VI model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../estimation_comparison/fucci.html">Comparison of velocities between EM and VI model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../estimation_comparison/model_fit.html">Model fit comparsion - MSE, velocity confidence, correlation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../estimation_comparison/pancreas.html">Comparison of velocities between EM and VI model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../estimation_comparison/runtime.html">Runtime comparison</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Time Dependent Rates</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../time_dependent_rates/mse_comparison.html">MSE with time dependent transcription rate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../time_dependent_rates/pancreas.html">MSE with time dependent transcription rate</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Permutation Score</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../permutation_score/pfc.html">Permutation score analysis - Pre-frontal cortex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../permutation_score/dataset_comparison.html">Permutation score - Dataset comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="../permutation_score/old_brain.html">Imports and helper functions</a></li>






<li class="toctree-l1"><a class="reference internal" href="../permutation_score/spermatogenesis.html">Permutation score analysis - Spermatogenesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../permutation_score/pancreas.html">Permutation score analysis - Pancreas</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Uncertainty</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="pancreas.html">Uncertainty analysis - Pancreas</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Uncertainty analysis - Pancreas</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Case Studies</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../case_studies/dentategyrus.html">Uncertainty analysis - Dentate gyrus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../case_studies/pbmc.html">PBMC</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Runtime Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../runtime_analysis/velo_runtime_analysis.html">VeloVI Runtime Analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Preprocessing Stability</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../preprocessing_stability/dentategyrus/README.html">Preprocessing analysis for RNA velocity in dentate gyurs</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/adata_generation.html">Data generation for RNA velocity analysis in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/alevin_coll_decoy_gtr_em_ss.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/alevin_coll_decoy_gtr_vi.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/alevin_coll_gtr_em_ss.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/alevin_coll_gtr_vi.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/alevin_sep_decoy_gtr_em_ss.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/alevin_sep_decoy_gtr_vi.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/alevin_sep_gtr_em_ss.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/alevin_sep_gtr_vi.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/alevin_spliced_unspliced_gtr_em_ss.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/alevin_spliced_unspliced_gtr_vi.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/correlation_analysis.html">Correlation analysis across preprocessing tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/kallisto_isocollapse_exclude_em_ss.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/kallisto_isocollapse_exclude_vi.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/kallisto_isocollapse_include_em_ss.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/kallisto_isocollapse_include_vi.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/kallisto_isoseparate_exclude_em_ss.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/kallisto_isoseparate_exclude_vi.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/kallisto_isoseparate_include_em_ss.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/kallisto_isoseparate_include_vi.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/starsolo_em_ss.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/starsolo_subtr_em_ss.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/starsolo_subtr_vi.html">RNA velocity in dentate gyrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/dentategyrus/starsolo_vi.html">RNA velocity in dentate gyrus</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../preprocessing_stability/old_brain/README.html">Preprocessing analysis for RNA velocity in mouse brain</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/adata_generation.html">Data generation for RNA velocity analysis in mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/alevin_coll_decoy_gtr_em_ss.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/alevin_coll_decoy_gtr_vi.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/alevin_coll_gtr_em_ss.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/alevin_coll_gtr_vi.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/alevin_sep_decoy_gtr_em_ss.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/alevin_sep_decoy_gtr_vi.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/alevin_sep_gtr_em_ss.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/alevin_sep_gtr_vi.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/alevin_spliced_unspliced_gtr_em_ss.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/alevin_spliced_unspliced_gtr_vi.html">RNA velocity in adult mouse brain</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/correlation_analysis.html">Correlation analysis across preprocessing tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/dropest_em_ss.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/dropest_vi.html">RNA velocity in adult mouse brain</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/kallisto_isocollapse_exclude_em_ss.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/kallisto_isocollapse_exclude_vi.html">RNA velocity in adult mouse brain</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/kallisto_isocollapse_include_em_ss.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/kallisto_isocollapse_include_vi.html">RNA velocity in adult mouse brain</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/kallisto_isoseparate_exclude_em_ss.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/kallisto_isoseparate_exclude_vi.html">RNA velocity in adult mouse brain</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/kallisto_isoseparate_include_em_ss.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/kallisto_isoseparate_include_vi.html">RNA velocity in pancreatic endocrinogenesis</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/starsolo_em_ss.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/starsolo_subtr_em_ss.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/starsolo_subtr_vi.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/starsolo_vi.html">RNA velocity in adult mouse brain</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/velocyto_em_ss.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/old_brain/velocyto_vi.html">RNA velocity in adult mouse brain</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../preprocessing_stability/pancreas/README.html">Preprocessing analysis for RNA velocity in panreatic endocrinogenesis</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/adata_generation.html">Data generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/alevin_coll_decoy_gtr_em_ss.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/alevin_coll_decoy_gtr_vi.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/alevin_coll_gtr_em_ss.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/alevin_coll_gtr_vi.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/alevin_sep_decoy_gtr_em_ss.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/alevin_sep_decoy_gtr_vi.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/alevin_sep_gtr_em_ss.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/alevin_sep_gtr_vi.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/alevin_spliced_unspliced_gtr_em_ss.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/alevin_spliced_unspliced_gtr_vi.html">RNA velocity in pancreatic endocrinogenesis</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/correlation_analysis.html">Correlation analysis across preprocessing tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/dropest_em_ss.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/dropest_vi.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/kallisto_isocollapse_exclude_em_ss.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/kallisto_isocollapse_exclude_vi.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/kallisto_isocollapse_include_em_ss.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/kallisto_isocollapse_include_vi.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/kallisto_isoseparate_exclude_em_ss.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/kallisto_isoseparate_exclude_vi.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/kallisto_isoseparate_include_em_ss.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/kallisto_isoseparate_include_vi.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/starsolo_em_ss.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/starsolo_subtr_em_ss.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/starsolo_subtr_vi.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/starsolo_vi.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/velocyto_em_ss.html">RNA velocity in pancreatic endocrinogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pancreas/velocyto_vi.html">RNA velocity in pancreatic endocrinogenesis</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../preprocessing_stability/pfc/README.html">Preprocessing analysis for RNA velocity in the prefrontal coretex</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/adata_generation.html">Data generation for RNA velocity analysis in pre-frontal cortex</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/alevin_coll_decoy_gtr_em_ss.html">RNA velocity in adult mouse brain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/alevin_coll_decoy_gtr_vi.html">RNA velocity in PFC</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/alevin_coll_gtr_em_ss.html">RNA velocity in PFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/alevin_coll_gtr_vi.html">RNA velocity in PFC</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/alevin_sep_decoy_gtr_em_ss.html">RNA velocity in PFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/alevin_sep_decoy_gtr_vi.html">RNA velocity in PFC</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/alevin_sep_gtr_em_ss.html">RNA velocity in PFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/alevin_sep_gtr_vi.html">RNA velocity in PFC</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/alevin_spliced_unspliced_gtr_em_ss.html">RNA velocity in PFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/alevin_spliced_unspliced_gtr_vi.html">RNA velocity in PFC</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/correlation_analysis.html">Correlation analysis across preprocessing tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/dropest_em_ss.html">RNA velocity in PFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/dropest_vi.html">RNA velocity in PFC</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/kallisto_isocollapse_exclude_em_ss.html">RNA velocity in PFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/kallisto_isocollapse_exclude_vi.html">RNA velocity in PFC</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/kallisto_isocollapse_include.html">RNA velocity in PFC</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/kallisto_isocollapse_include_em_ss.html">RNA velocity in PFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/kallisto_isoseparate_exclude_em_ss.html">RNA velocity in PFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/kallisto_isoseparate_exclude_vi.html">RNA velocity in PFC</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/kallisto_isoseparate_include_em_ss.html">RNA velocity in PFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/kallisto_isoseparate_include_vi.html">RNA velocity in PFC</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/starsolo_em_ss.html">RNA velocity in PFC</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/starsolo_subtr_em_ss.html">RNA velocity in PFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/starsolo_subtr_vi.html">RNA velocity in PFC</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/starsolo_vi.html">RNA velocity in PFC</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/velocyto_em_ss.html">RNA velocity in PFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/pfc/velocyto_vi.html">RNA velocity in PFC</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/README.html">Preprocessing analysis for RNA velocity in spermatogenesis</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/adata_generation.html">Data generation for RNA velocity analysis in spermatogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/alevin_coll_decoy_gtr_em_ss.html">RNA velocity in spermatogenesis</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/alevin_coll_decoy_gtr_vi.html">RNA velocity in spermatogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/alevin_coll_gtr_em_ss.html">RNA velocity in spermatogenesis</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/alevin_coll_gtr_vi.html">RNA velocity in spermatogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/alevin_sep_decoy_gtr_em_ss.html">RNA velocity in spermatogenesis</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/alevin_sep_decoy_gtr_vi.html">RNA velocity in spermatogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/alevin_sep_gtr_em_ss.html">RNA velocity in spermatogenesis</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/alevin_sep_gtr_vi.html">RNA velocity in spermatogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/alevin_spliced_unspliced_gtr_em_ss.html">RNA velocity in spermatogenesis</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/alevin_spliced_unspliced_gtr_vi.html">RNA velocity in spermatogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/correlation_analysis.html">Correlation analysis across preprocessing tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/dropest_em_ss.html">RNA velocity in spermatogenesis</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/dropest_vi.html">RNA velocity in spermatogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/kallisto_isocollapse_exclude_em_ss.html">RNA velocity in spermatogenesis</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/kallisto_isocollapse_exclude_vi.html">RNA velocity in spermatogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/kallisto_isocollapse_include_em_ss.html">RNA velocity in spermatogenesis</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/kallisto_isocollapse_include_vi.html">RNA velocity in spermatogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/kallisto_isoseparate_exclude_em_ss.html">RNA velocity in spermatogenesis</a></li>

<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/kallisto_isoseparate_exclude_vi.html">RNA velocity in spermatogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/kallisto_isoseparate_include_em_ss.html">RNA velocity in spermatogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/kallisto_isoseparate_include_vi.html">RNA velocity in spermatogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/starsolo_em_ss.html">RNA velocity in spermatogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/starsolo_subtr_em_ss.html">RNA velocity in spermatogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/starsolo_subtr_vi.html">RNA velocity in spermatogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/starsolo_vi.html">RNA velocity in spermatogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/velocyto_em_ss.html">RNA velocity in spermatogenesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing_stability/spermatogenesis/velocyto_vi.html">RNA velocity in spermatogenesis</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/YosefLab/velovi_reproducibility" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/uncertainty/pancreas_noise.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Uncertainty analysis - Pancreas</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#library-imports">Library imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-settings">General settings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#function-definition">Function definition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-loading">Data loading</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#umi-downsampling">UMI Downsampling</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot">Plot</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#unspliced-dropout">Unspliced dropout</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Plot</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiplicative-noise">Multiplicative noise</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Plot</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="uncertainty-analysis-pancreas">
<h1>Uncertainty analysis - Pancreas<a class="headerlink" href="#uncertainty-analysis-pancreas" title="Permalink to this heading">#</a></h1>
<section id="library-imports">
<h2>Library imports<a class="headerlink" href="#library-imports" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">csr_matrix</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">mplscience</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">statannotations.Annotator</span> <span class="kn">import</span> <span class="n">Annotator</span>

<span class="kn">import</span> <span class="nn">scanpy</span> <span class="k">as</span> <span class="nn">sc</span>
<span class="kn">import</span> <span class="nn">scvelo</span> <span class="k">as</span> <span class="nn">scv</span>
<span class="kn">import</span> <span class="nn">scvi</span>
<span class="kn">from</span> <span class="nn">scvelo.plotting.simulation</span> <span class="kn">import</span> <span class="n">compute_dynamics</span>
<span class="kn">from</span> <span class="nn">velovi</span> <span class="kn">import</span> <span class="n">preprocess_data</span><span class="p">,</span> <span class="n">VELOVI</span>
<span class="kn">from</span> <span class="nn">velovi._model</span> <span class="kn">import</span> <span class="n">_compute_directional_statistics_tensor</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;../..&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">paths</span> <span class="kn">import</span> <span class="n">DATA_DIR</span><span class="p">,</span> <span class="n">FIG_DIR</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Global seed set to 0
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
</pre></div>
</div>
</div>
</div>
</section>
<section id="general-settings">
<h2>General settings<a class="headerlink" href="#general-settings" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scvi</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">dl_pin_memory_gpu_training</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">reset_defaults</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">reset_orig</span><span class="p">()</span>
<span class="n">scv</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">set_figure_params</span><span class="p">(</span><span class="s1">&#39;scvelo&#39;</span><span class="p">,</span> <span class="n">dpi_save</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SAVE_FIGURES</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">SAVE_FIGURES</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">FIG_DIR</span> <span class="o">/</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="o">/</span> <span class="s1">&#39;pancreas_noise&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="function-definition">
<h2>Function definition<a class="headerlink" href="#function-definition" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fit_velovi</span><span class="p">(</span><span class="n">bdata</span><span class="p">):</span>
    <span class="n">VELOVI</span><span class="o">.</span><span class="n">setup_anndata</span><span class="p">(</span><span class="n">bdata</span><span class="p">,</span> <span class="n">spliced_layer</span><span class="o">=</span><span class="s2">&quot;Ms&quot;</span><span class="p">,</span> <span class="n">unspliced_layer</span><span class="o">=</span><span class="s2">&quot;Mu&quot;</span><span class="p">)</span>

    <span class="n">vae</span> <span class="o">=</span> <span class="n">VELOVI</span><span class="p">(</span><span class="n">bdata</span><span class="p">)</span>

    <span class="n">vae</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">vae</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;elbo_train&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">20</span><span class="p">:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;elbo_train&#39;</span><span class="p">:</span> <span class="s1">&#39;elbo&#39;</span><span class="p">})</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;set&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;train&#39;</span>

    <span class="n">_df</span> <span class="o">=</span> <span class="n">vae</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;elbo_validation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">20</span><span class="p">:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;elbo_validation&#39;</span><span class="p">:</span> <span class="s1">&#39;elbo&#39;</span><span class="p">})</span>
    <span class="n">_df</span><span class="p">[</span><span class="s1">&#39;set&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;validation&#39;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">mplscience</span><span class="o">.</span><span class="n">style_context</span><span class="p">():</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;epoch&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;elbo&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#0173B2&#39;</span><span class="p">,</span> <span class="s1">&#39;#DE8F05&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

    <span class="n">latent_time</span> <span class="o">=</span> <span class="n">vae</span><span class="o">.</span><span class="n">get_latent_time</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
    <span class="n">velocities</span> <span class="o">=</span> <span class="n">vae</span><span class="o">.</span><span class="n">get_velocity</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">velo_statistic</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">latent_time</span>
    <span class="n">scaling</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">/</span> <span class="n">t</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">bdata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s2">&quot;velocities_velovi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">velocities</span> <span class="o">/</span> <span class="n">scaling</span>
    <span class="n">bdata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s2">&quot;latent_time_velovi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">latent_time</span>

    <span class="n">bdata</span><span class="o">.</span><span class="n">var</span><span class="p">[</span><span class="s2">&quot;fit_alpha&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vae</span><span class="o">.</span><span class="n">get_rates</span><span class="p">()[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scaling</span>
    <span class="n">bdata</span><span class="o">.</span><span class="n">var</span><span class="p">[</span><span class="s2">&quot;fit_beta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vae</span><span class="o">.</span><span class="n">get_rates</span><span class="p">()[</span><span class="s2">&quot;beta&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scaling</span>
    <span class="n">bdata</span><span class="o">.</span><span class="n">var</span><span class="p">[</span><span class="s2">&quot;fit_gamma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vae</span><span class="o">.</span><span class="n">get_rates</span><span class="p">()[</span><span class="s2">&quot;gamma&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scaling</span>
    <span class="n">bdata</span><span class="o">.</span><span class="n">var</span><span class="p">[</span><span class="s2">&quot;fit_t_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">softplus</span><span class="p">(</span><span class="n">vae</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">switch_time_unconstr</span><span class="p">)</span>
        <span class="o">.</span><span class="n">detach</span><span class="p">()</span>
        <span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
        <span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="p">)</span> <span class="o">*</span> <span class="n">scaling</span>
    <span class="n">bdata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s2">&quot;fit_t&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">latent_time</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">scaling</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">bdata</span><span class="o">.</span><span class="n">var</span><span class="p">[</span><span class="s1">&#39;fit_scaling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">return</span> <span class="n">vae</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_phase_portrait</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">gene</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s1">&#39;unspliced&#39;</span><span class="p">:</span> <span class="n">adata</span><span class="p">[:,</span> <span class="n">gene</span><span class="p">]</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s1">&#39;Mu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
            <span class="s1">&#39;spliced&#39;</span><span class="p">:</span> <span class="n">adata</span><span class="p">[:,</span> <span class="n">gene</span><span class="p">]</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s1">&#39;Ms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">mplscience</span><span class="o">.</span><span class="n">style_context</span><span class="p">():</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;spliced&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;unspliced&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">unspliced</span><span class="p">,</span> <span class="n">spliced</span> <span class="o">=</span> <span class="n">compute_dynamics</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="n">gene</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s1">&#39;unspliced&#39;</span><span class="p">:</span> <span class="n">unspliced</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
                <span class="s1">&#39;spliced&#39;</span><span class="p">:</span> <span class="n">spliced</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spliced</span><span class="p">,</span> <span class="n">unspliced</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">spliced_steady_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">spliced</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">spliced</span><span class="p">))</span>
        <span class="n">unspliced_steady_state</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gene</span><span class="p">,</span> <span class="s1">&#39;fit_gamma&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">adata</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gene</span><span class="p">,</span> <span class="s1">&#39;fit_beta&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">spliced_steady_state</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">spliced_steady_state</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">unspliced</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spliced_steady_state</span><span class="p">,</span> <span class="n">unspliced_steady_state</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">SAVE_FIGURES</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
            <span class="n">FIG_DIR</span> <span class="o">/</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="o">/</span> <span class="s1">&#39;pancreas&#39;</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;phase_portrait_</span><span class="si">{</span><span class="n">gene</span><span class="si">}</span><span class="s1">.svg&#39;</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span>
            <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_extrinisic_uncertainty</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">vae</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">velovi._model</span> <span class="kn">import</span> <span class="n">_compute_directional_statistics_tensor</span>
    <span class="kn">from</span> <span class="nn">scvi.utils</span> <span class="kn">import</span> <span class="n">track</span>
    <span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">redirect_stdout</span>
    <span class="kn">import</span> <span class="nn">io</span>

    <span class="n">extrapolated_cells_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">track</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)):</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">buf</span><span class="p">,</span> <span class="n">redirect_stdout</span><span class="p">(</span><span class="n">buf</span><span class="p">):</span>
            <span class="n">vkey</span> <span class="o">=</span> <span class="s2">&quot;velocities_velovi_</span><span class="si">{i}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">vae</span><span class="o">.</span><span class="n">get_velocity</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">velo_statistic</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
            <span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">vkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="n">scv</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">velocity_graph</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">vkey</span><span class="o">=</span><span class="n">vkey</span><span class="p">,</span> <span class="n">sqrt_transform</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">approx</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">t_mat</span> <span class="o">=</span> <span class="n">scv</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_transition_matrix</span><span class="p">(</span>
                <span class="n">adata</span><span class="p">,</span> <span class="n">vkey</span><span class="o">=</span><span class="n">vkey</span><span class="p">,</span> <span class="n">self_transitions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_negative_cosines</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">extrapolated_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">t_mat</span> <span class="o">@</span> <span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s2">&quot;Ms&quot;</span><span class="p">])</span>
            <span class="n">extrapolated_cells_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extrapolated_cells</span><span class="p">)</span>
    <span class="n">extrapolated_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">extrapolated_cells_list</span><span class="p">)</span>
    <span class="n">df</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_compute_directional_statistics_tensor</span><span class="p">(</span><span class="n">extrapolated_cells</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_cells</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">n_obs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">directional_cosine_sim_variance</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">downsample_cells</span><span class="p">(</span><span class="n">adata</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span> <span class="n">frac</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">genes_to_use</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">sc</span><span class="o">.</span><span class="n">AnnData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Downsample cells&#39; counts.</span>
<span class="sd">    </span>
<span class="sd">    Frac is frac of observed library size to downsample to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">scanpy.preprocessing._simple</span> <span class="kn">import</span> <span class="n">_downsample_per_cell</span>
    <span class="n">adata</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">random_state</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">replace</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;spliced&quot;</span><span class="p">,</span> <span class="s2">&quot;unspliced&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">]:</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;X&quot;</span> <span class="k">else</span> <span class="n">adata</span><span class="o">.</span><span class="n">X</span>
        <span class="n">counts_per_cell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">counts_per_cell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">counts_per_cell</span> <span class="o">*</span> <span class="n">frac</span><span class="p">)</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">_downsample_per_cell</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">counts_per_cell</span><span class="p">,</span> <span class="n">random_state</span><span class="p">,</span> <span class="n">replace</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span>
            <span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">adata</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">mat</span>
    <span class="n">scv</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">filter_and_normalize</span><span class="p">(</span><span class="n">adata</span><span class="p">)</span>
    <span class="n">adata</span> <span class="o">=</span> <span class="n">adata</span><span class="p">[:,</span> <span class="n">genes_to_use</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">pca</span><span class="p">(</span><span class="n">adata</span><span class="p">)</span>
    <span class="n">scv</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">moments</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">n_pcs</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">adata</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dropout_unspliced_gene</span><span class="p">(</span><span class="n">adata</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span> <span class="n">num_genes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">frac</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">genes_to_use</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">sc</span><span class="o">.</span><span class="n">AnnData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Downsample cells&#39; counts.&quot;&quot;&quot;</span>
    <span class="n">adata</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;unspliced&quot;</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="c1"># Use the same genes for each call with the same num_genes</span>
    <span class="n">random_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">gene_idx</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">genes_to_use</span><span class="p">)),</span> <span class="n">size</span><span class="o">=</span><span class="n">num_genes</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">gene_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">var_names</span><span class="p">,</span> <span class="n">genes_to_use</span><span class="p">[</span><span class="n">gene_idx</span><span class="p">])</span>
    <span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span>
    <span class="c1"># adata.layers[key][:, gene_idx]  = np.rint(frac * adata.layers[key][:, gene_idx])</span>
    <span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">key</span><span class="p">][:,</span> <span class="n">gene_idx</span><span class="p">]</span>  <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">key</span><span class="p">][:,</span> <span class="n">gene_idx</span><span class="p">]</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span> <span class="n">frac</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
    <span class="n">scv</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">filter_and_normalize</span><span class="p">(</span><span class="n">adata</span><span class="p">)</span>
    <span class="n">adata</span><span class="o">.</span><span class="n">var</span><span class="p">[</span><span class="s2">&quot;scaled_gene&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">adata</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">var_names</span><span class="p">[</span><span class="n">gene_idx</span><span class="p">],</span> <span class="s2">&quot;scaled_gene&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">adata</span> <span class="o">=</span> <span class="n">adata</span><span class="p">[:,</span> <span class="n">genes_to_use</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">scv</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">moments</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">n_pcs</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">adata</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">keep_fraction_of_celltype</span><span class="p">(</span><span class="n">adata</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span> <span class="n">labels_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">frac</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">genes_to_use</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">sc</span><span class="o">.</span><span class="n">AnnData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Keep fraction of cells from cell type.&quot;&quot;&quot;</span>
    <span class="n">adata</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">labels_key</span><span class="p">]</span> <span class="o">==</span> <span class="n">category</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">remove_subset_ct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">frac</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">cur_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">new_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">cur_inds</span><span class="p">,</span> <span class="n">remove_subset_ct</span><span class="p">)</span>
    <span class="n">adata</span> <span class="o">=</span> <span class="n">adata</span><span class="p">[</span><span class="n">new_inds</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">scv</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">filter_and_normalize</span><span class="p">(</span><span class="n">adata</span><span class="p">)</span>
    <span class="n">adata</span> <span class="o">=</span> <span class="n">adata</span><span class="p">[:,</span> <span class="n">genes_to_use</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">pca</span><span class="p">(</span><span class="n">adata</span><span class="p">)</span>
    <span class="n">scv</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">moments</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">n_pcs</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">adata</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_noise_to_celltype</span><span class="p">(</span><span class="n">adata</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">AnnData</span><span class="p">,</span> <span class="n">labels_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">gene_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">genes_to_use</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sc</span><span class="o">.</span><span class="n">AnnData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add multiplicative noise to a cell type.&quot;&quot;&quot;</span>
    <span class="n">adata</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">labels_key</span><span class="p">]</span> <span class="o">==</span> <span class="n">category</span>
    <span class="n">noise_ms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">adata</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="n">noise_mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">adata</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">gene_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">noise_ms</span><span class="p">[:,</span> <span class="o">~</span><span class="n">gene_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">noise_mu</span><span class="p">[:,</span> <span class="o">~</span><span class="n">gene_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">scv</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">filter_and_normalize</span><span class="p">(</span><span class="n">adata</span><span class="p">)</span>
    <span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s2">&quot;spliced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s2">&quot;spliced&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
    <span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s2">&quot;unspliced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s2">&quot;unspliced&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
    <span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s2">&quot;spliced&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">*=</span> <span class="n">noise_ms</span>
    <span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s2">&quot;unspliced&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">*=</span> <span class="n">noise_mu</span>
    <span class="c1"># X is same as spliced, but log1pd</span>
    <span class="n">adata</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s2">&quot;spliced&quot;</span><span class="p">])</span>
    <span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s2">&quot;spliced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s2">&quot;spliced&quot;</span><span class="p">]</span>
    <span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s2">&quot;unspliced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s2">&quot;unspliced&quot;</span><span class="p">]</span>
    <span class="n">adata</span> <span class="o">=</span> <span class="n">adata</span><span class="p">[:,</span> <span class="n">genes_to_use</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">pca</span><span class="p">(</span><span class="n">adata</span><span class="p">)</span>
    <span class="n">scv</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">moments</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">n_pcs</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">adata</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-loading">
<h2>Data loading<a class="headerlink" href="#data-loading" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata</span> <span class="o">=</span> <span class="n">scv</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">pancreas</span><span class="p">(</span><span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;pancreas&quot;</span> <span class="o">/</span> <span class="s2">&quot;endocrinogenesis_day15.h5ad&quot;</span><span class="p">)</span>

<span class="c1"># Find a universal gene set</span>
<span class="n">bdata</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">scv</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">filter_and_normalize</span><span class="p">(</span><span class="n">bdata</span><span class="p">,</span> <span class="n">min_shared_counts</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">n_top_genes</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
<span class="n">scv</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">moments</span><span class="p">(</span><span class="n">bdata</span><span class="p">,</span> <span class="n">n_pcs</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">bdata</span> <span class="o">=</span> <span class="n">preprocess_data</span><span class="p">(</span><span class="n">bdata</span><span class="p">)</span>
<span class="n">genes_to_use</span> <span class="o">=</span> <span class="n">bdata</span><span class="o">.</span><span class="n">var_names</span>

<span class="n">adata</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Filtered out 21611 genes that are detected 30 counts (shared).
Normalized count data: X, spliced, unspliced.
Extracted 2000 highly variable genes.
Logarithmized X.
computing neighbors
    finished (0:00:04) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:00) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
computing velocities
    finished (0:00:00) --&gt; added 
    &#39;velocity&#39;, velocity vectors for each individual cell (adata.layers)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AnnData object with n_obs  n_vars = 3696  27998
    obs: &#39;clusters_coarse&#39;, &#39;clusters&#39;, &#39;S_score&#39;, &#39;G2M_score&#39;
    var: &#39;highly_variable_genes&#39;
    uns: &#39;clusters_coarse_colors&#39;, &#39;clusters_colors&#39;, &#39;day_colors&#39;, &#39;neighbors&#39;, &#39;pca&#39;
    obsm: &#39;X_pca&#39;, &#39;X_umap&#39;
    layers: &#39;spliced&#39;, &#39;unspliced&#39;
    obsp: &#39;distances&#39;, &#39;connectivities&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="umi-downsampling">
<h2>UMI Downsampling<a class="headerlink" href="#umi-downsampling" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata</span> <span class="o">=</span> <span class="n">scv</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">pancreas</span><span class="p">(</span><span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;pancreas&quot;</span> <span class="o">/</span> <span class="s2">&quot;endocrinogenesis_day15.h5ad&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uncertainty_full_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Uncertainty&quot;</span><span class="p">,</span> <span class="s2">&quot;Fraction removed&quot;</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span><span class="p">])</span>
<span class="n">perturbed_adatas</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">fracs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">]</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">fracs</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">s</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">bdata</span> <span class="o">=</span> <span class="n">downsample_cells</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">genes_to_use</span><span class="o">=</span><span class="n">genes_to_use</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bdata</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">bdata</span> <span class="o">=</span> <span class="n">preprocess_data</span><span class="p">(</span><span class="n">bdata</span><span class="p">,</span> <span class="n">min_max_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">filter_on_r2</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">perturbed_adatas</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">bdata</span>
    <span class="n">VELOVI</span><span class="o">.</span><span class="n">setup_anndata</span><span class="p">(</span><span class="n">bdata</span><span class="p">,</span> <span class="n">spliced_layer</span><span class="o">=</span><span class="s2">&quot;Ms&quot;</span><span class="p">,</span> <span class="n">unspliced_layer</span><span class="o">=</span><span class="s2">&quot;Mu&quot;</span><span class="p">)</span>
    <span class="n">vae</span> <span class="o">=</span> <span class="n">VELOVI</span><span class="p">(</span><span class="n">bdata</span><span class="p">)</span>
    <span class="n">vae</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="n">uncertainty_df</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">vae</span><span class="o">.</span><span class="n">get_directional_uncertainty</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">extrinsic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">compute_extrinisic_uncertainty</span><span class="p">(</span><span class="n">bdata</span><span class="p">,</span> <span class="n">vae</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">25</span><span class="p">))</span>
    <span class="n">intrinsic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">uncertainty_df</span><span class="o">.</span><span class="n">directional_cosine_sim_variance</span><span class="p">)</span>
    <span class="n">unc_type</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Intrinsic&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">intrinsic</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Extrinsic&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">extrinsic</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">intrinsic</span><span class="p">,</span> <span class="n">extrinsic</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Fraction removed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unc_type</span>
    <span class="n">uncertainty_full_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">uncertainty_full_df</span><span class="p">,</span> <span class="n">df</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
    finished (0:00:00) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:00) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 496/500:  99%|| 496/500 [01:28&lt;00:00,  5.61it/s, loss=-2.41e+03, v_num=1]
Monitored metric elbo_validation did not improve in the last 45 records. Best score: -2328.608. Signaling Trainer to stop.
<span class=" -Color -Color-Blue">INFO    </span> velovi: Sampling from model<span class=" -Color -Color-Yellow">...</span>                                                                            
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
Global seed set to 0
Global seed set to 0
Global seed set to 0
Global seed set to 0
Global seed set to 0
Global seed set to 0
Global seed set to 0
Global seed set to 0
Global seed set to 0
Global seed set to 0
Global seed set to 0
Global seed set to 0
Global seed set to 0
Global seed set to 0
Global seed set to 0
Global seed set to 0
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
Global seed set to 0
Global seed set to 0
Global seed set to 0
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
Global seed set to 0
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.
  new_rank_zero_deprecation(
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.
  return new_rank_zero_deprecation(*args, **kwargs)
[Parallel(n_jobs=-1)]: Done  88 tasks      | elapsed:    4.5s
[Parallel(n_jobs=-1)]: Done 808 tasks      | elapsed:    5.3s
[Parallel(n_jobs=-1)]: Done 3522 tasks      | elapsed:    7.4s
[Parallel(n_jobs=-1)]: Done 3657 out of 3696 | elapsed:    7.5s remaining:    0.1s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    7.5s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   0%|          | 0/25 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7e4925c287c243f093828324ba5da2a5", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   4%|         | 1/25 [00:05&lt;02:02,  5.09s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e3fe50b5f0ce412ab6b3b0bcbc48d5ac", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   8%|         | 2/25 [00:10&lt;01:58,  5.14s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "21cd24fc492f4003843e5458213bcad9", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  12%|        | 3/25 [00:13&lt;01:38,  4.47s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f188be93ed1e453297ebeb0d76fcd222", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  16%|        | 4/25 [00:18&lt;01:38,  4.70s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d88e372d8b7e44fbbdf82dd153a26248", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  20%|        | 5/25 [00:24&lt;01:36,  4.84s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1155d1598c0c454abeab52d79b1778dd", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  24%|       | 6/25 [00:29&lt;01:33,  4.94s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1942b7e6b35d4b49b6285405e0d975e4", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  28%|       | 7/25 [00:34&lt;01:29,  4.95s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "33ea24000a32472b989e4c7cd177ebc6", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  32%|      | 8/25 [00:39&lt;01:24,  5.00s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e625b3cf6a2546a28c2c9687f15d0107", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  36%|      | 9/25 [00:43&lt;01:16,  4.78s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e4f8da36bf684ead86fd73e807a4eb34", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  40%|      | 10/25 [00:48&lt;01:13,  4.89s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3c66119577534a3f9aad30ce79bc9ffa", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  44%|     | 11/25 [00:53&lt;01:09,  4.94s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a321443fc23140379d2ff984568be433", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  48%|     | 12/25 [00:58&lt;01:03,  4.88s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6a10e431dcb944098dbc8ba1bfc0976b", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  52%|    | 13/25 [01:03&lt;00:58,  4.90s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1b057b7eb7d54d3f8a62bbd81ac7b577", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  56%|    | 14/25 [01:08&lt;00:54,  4.97s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3c32219828e9475f8f28829d2d7fdaa7", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  60%|    | 15/25 [01:13&lt;00:50,  5.00s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "2a59ed4623de469a937ed56f4266c2f0", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  64%|   | 16/25 [01:18&lt;00:45,  5.03s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "cf9d246f5e334e24a85c241ea0c6e10f", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  68%|   | 17/25 [01:23&lt;00:39,  5.00s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "78e1b4827cb54f59a5112ff4136c7471", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  72%|  | 18/25 [01:28&lt;00:33,  4.84s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c33f54638f0443429ab346a59c02f26d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  76%|  | 19/25 [01:33&lt;00:29,  4.93s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "beb9ecaa48af44f9b48cda8832e435fa", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  80%|  | 20/25 [01:38&lt;00:24,  4.99s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7ba4b17af1cb4b948d8c614234af065a", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  84%| | 21/25 [01:43&lt;00:20,  5.01s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a4951dda0607449da6da685d2211db22", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  88%| | 22/25 [01:48&lt;00:15,  5.09s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9e1c4dbb169249919ab7c02a3ceb01f4", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  92%|| 23/25 [01:53&lt;00:09,  4.85s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "bd83e30ba2ef48e7b3bfca9ce83400ef", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  96%|| 24/25 [01:56&lt;00:04,  4.49s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "057e2f9de50a44379ef4c06640bbfc59", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...: 100%|| 25/25 [02:01&lt;00:00,  4.87s/it]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2344 tasks      | elapsed:    0.6s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    0.8s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
    finished (0:00:00) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:00) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 412/500:  82%| | 412/500 [01:12&lt;00:15,  5.69it/s, loss=-2.47e+03, v_num=1]
Monitored metric elbo_validation did not improve in the last 45 records. Best score: -2379.069. Signaling Trainer to stop.
<span class=" -Color -Color-Blue">INFO    </span> velovi: Sampling from model<span class=" -Color -Color-Yellow">...</span>                                                                            
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2008 tasks      | elapsed:    1.6s
[Parallel(n_jobs=-1)]: Done 3612 tasks      | elapsed:    2.8s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    2.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   0%|          | 0/25 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d8d4f4bd049d48379d97c1ae44c75fb3", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   4%|         | 1/25 [00:05&lt;02:07,  5.30s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c6d7d58dfcd343248cb1d7c9f0253cc3", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   8%|         | 2/25 [00:10&lt;01:58,  5.17s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "8afcd6e251524c51ba534c22dae4356b", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  12%|        | 3/25 [00:13&lt;01:37,  4.41s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "746d2c802be540b4bbedbb8cac04066c", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  16%|        | 4/25 [00:19&lt;01:39,  4.72s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c9301d04e69f44b5a6a25642bdcf10a7", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  20%|        | 5/25 [00:24&lt;01:37,  4.87s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "743746b363ee4644abd6b7834242f8d3", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  24%|       | 6/25 [00:29&lt;01:33,  4.93s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e23053bfa8fa459e97e546c940a55e1b", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  28%|       | 7/25 [00:34&lt;01:29,  4.99s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "5e1d994fc6054d2eb547014a5d145624", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  32%|      | 8/25 [00:39&lt;01:25,  5.03s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3a77cfa63e74424f9b103e0b6cff81ea", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  36%|      | 9/25 [00:44&lt;01:19,  4.95s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6dc942f5e02b49fbb61a8d681faaf3f8", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  40%|      | 10/25 [00:49&lt;01:14,  4.94s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e9c3eec80eb347c5944a8c5012871edf", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  44%|     | 11/25 [00:54&lt;01:09,  4.98s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "db26f10069e642879d281e81d892e9f5", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  48%|     | 12/25 [00:59&lt;01:03,  4.91s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7110f59adfbd43909bcfc532bebc74f5", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  52%|    | 13/25 [01:04&lt;00:59,  4.98s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c79b7dd69fe94ee2accd78e45ccf0c98", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  56%|    | 14/25 [01:09&lt;00:54,  4.94s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "caf77ec5a8f847a498b6ac981d7aed98", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  60%|    | 15/25 [01:13&lt;00:49,  4.95s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f02556b4f3204e4087fa3975e48ac747", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  64%|   | 16/25 [01:18&lt;00:43,  4.78s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "5ec15a17e7c14ce9b8d5f7221af4c883", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  68%|   | 17/25 [01:23&lt;00:38,  4.82s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6aa0890496234d4693aefa94d2eb4205", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  72%|  | 18/25 [01:28&lt;00:34,  4.92s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c8ea0abff5fc42038251e7e9c1b99e4b", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  76%|  | 19/25 [01:33&lt;00:29,  4.99s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "59cb5dd87bb941b5ae6914f3a78f3a3d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  80%|  | 20/25 [01:38&lt;00:24,  4.97s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "8562661f282b412b9faba4d862bcfc99", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  84%| | 21/25 [01:43&lt;00:19,  4.92s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "dba0ea4b1d7742608fd09a8d740f96f6", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  88%| | 22/25 [01:48&lt;00:14,  4.89s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "260ce35f079049c9955aef792e8854b4", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  92%|| 23/25 [01:53&lt;00:09,  4.90s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a88f3663d12e4923a200a1baa7a02840", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  96%|| 24/25 [01:57&lt;00:04,  4.85s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3bf4772efcf34d1492479f8343ed5d8e", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...: 100%|| 25/25 [02:02&lt;00:00,  4.92s/it]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2371 tasks      | elapsed:    0.6s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    0.8s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
    finished (0:00:00) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:00) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 371/500:  74%|  | 371/500 [01:04&lt;00:22,  5.74it/s, loss=-2.61e+03, v_num=1]
Monitored metric elbo_validation did not improve in the last 45 records. Best score: -2486.928. Signaling Trainer to stop.
<span class=" -Color -Color-Blue">INFO    </span> velovi: Sampling from model<span class=" -Color -Color-Yellow">...</span>                                                                            
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.2s
[Parallel(n_jobs=-1)]: Done 2008 tasks      | elapsed:    1.7s
[Parallel(n_jobs=-1)]: Done 3597 tasks      | elapsed:    2.8s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    2.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   0%|          | 0/25 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c8f211fe6e654350aadb10780e71fb51", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   4%|         | 1/25 [00:06&lt;02:29,  6.25s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "67e58f6c29a64e5eb2ea116f1e715714", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   8%|         | 2/25 [00:12&lt;02:25,  6.33s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "20c75cd443684554af6da9eb1579b03c", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  12%|        | 3/25 [00:19&lt;02:20,  6.39s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "bdef6ec2d56b479e812ebbfafbba996b", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  16%|        | 4/25 [00:25&lt;02:13,  6.38s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "54d61fa36811430e94c6e669c75237e8", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  20%|        | 5/25 [00:31&lt;02:07,  6.35s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a2caacc1bd3242c997d081620a6791f2", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  24%|       | 6/25 [00:38&lt;02:01,  6.37s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "cb029cc4c7924b44aa35a1ba12c28829", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  28%|       | 7/25 [00:44&lt;01:55,  6.41s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "759d7941cc3443f4a38ad6364dc22ced", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  32%|      | 8/25 [00:49&lt;01:41,  5.97s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f8d34bf3fb9a42ec9bb70d2514485dc0", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  36%|      | 9/25 [00:56&lt;01:37,  6.09s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "119e8cad92b449e6ad44b6b71547a93c", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  40%|      | 10/25 [01:02&lt;01:32,  6.20s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "4131e68c18bd41dca70632d698c7ae92", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  44%|     | 11/25 [01:08&lt;01:27,  6.24s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c594312016184142bd269d6ddc0f85d9", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  48%|     | 12/25 [01:14&lt;01:19,  6.10s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e646e06c689b40baa3211c12d5b1ae8d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  52%|    | 13/25 [01:20&lt;01:13,  6.15s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "57050480af8d4bc2889e0617829db899", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  56%|    | 14/25 [01:27&lt;01:08,  6.24s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ae111840461a417bb37981e4e754ba33", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  60%|    | 15/25 [01:32&lt;00:59,  5.99s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7164be019bbe433daafb85fec6a0e852", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  64%|   | 16/25 [01:37&lt;00:51,  5.75s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "29e9bbfa56c54f0a8c530393ee905ba0", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  68%|   | 17/25 [01:43&lt;00:45,  5.71s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f4a2d6d7dfd840f3b8610460aca3827c", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  72%|  | 18/25 [01:47&lt;00:37,  5.33s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "5c6b647fbe3342dea7f86f7268760347", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  76%|  | 19/25 [01:54&lt;00:33,  5.63s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "18226f6be30348c0b6132f9075b20a1d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  80%|  | 20/25 [02:00&lt;00:28,  5.73s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7b0e14eed5d844b897dbc6fa87f4d3b5", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  84%| | 21/25 [02:06&lt;00:24,  6.00s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e2a637adbc0f4372813ca5606bffb42b", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  88%| | 22/25 [02:13&lt;00:18,  6.07s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c0dd07c80b3a4de78312ddd2d1ae12e7", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  92%|| 23/25 [02:18&lt;00:11,  5.93s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "11b1824119424861b06ff279f4a8d27b", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  96%|| 24/25 [02:25&lt;00:06,  6.07s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "eb52b5dcafb447cd8e1ea3bb345e0e96", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...: 100%|| 25/25 [02:31&lt;00:00,  6.07s/it]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2398 tasks      | elapsed:    0.6s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    0.8s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
    finished (0:00:00) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:00) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 186/500:  37%|      | 186/500 [00:32&lt;00:55,  5.65it/s, loss=-2.99e+03, v_num=1]
Monitored metric elbo_validation did not improve in the last 45 records. Best score: -2793.657. Signaling Trainer to stop.
<span class=" -Color -Color-Blue">INFO    </span> velovi: Sampling from model<span class=" -Color -Color-Yellow">...</span>                                                                            
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2008 tasks      | elapsed:    1.6s
[Parallel(n_jobs=-1)]: Done 3612 tasks      | elapsed:    2.8s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    2.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   0%|          | 0/25 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "be019a446bd14b7694937465133d4cb9", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   4%|         | 1/25 [00:05&lt;02:23,  5.98s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "243aae57feac4da08e17127edc85ebb0", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   8%|         | 2/25 [00:11&lt;02:16,  5.95s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f966bb2f119b4f67a808945b09c34e8a", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  12%|        | 3/25 [00:18&lt;02:13,  6.07s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "4cfbf17b47a9474781df0f10ccbc38e8", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  16%|        | 4/25 [00:23&lt;02:05,  5.96s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "982d64278fe544d3824e7f3ab844514c", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  20%|        | 5/25 [00:30&lt;02:00,  6.04s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d5449e7ac60147a1af830ff9457f25a4", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  24%|       | 6/25 [00:32&lt;01:31,  4.81s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "cbe1203329894bc5b75d1940e0381e9f", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  28%|       | 7/25 [00:38&lt;01:32,  5.15s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "047c37b9f02040929f0b36565a942dde", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  32%|      | 8/25 [00:44&lt;01:34,  5.55s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "badc4ab6f91c4da7a9e29bbfa88d0031", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  36%|      | 9/25 [00:51&lt;01:32,  5.81s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a71e2afaf2844227ad733537921aaf30", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  40%|      | 10/25 [00:57&lt;01:29,  5.98s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c41bb6b03d7b4f538f1066651815c208", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  44%|     | 11/25 [01:00&lt;01:11,  5.12s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3fc88e36eec546c197869a9e0a615085", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  48%|     | 12/25 [01:06&lt;01:08,  5.23s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d297d3557dc04ee5926991ec5e9fb427", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  52%|    | 13/25 [01:12&lt;01:08,  5.69s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ae71b6819fa047aea99a969ffbcd5055", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  56%|    | 14/25 [01:18&lt;01:02,  5.66s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "039a1372225e4ef8be99dbcc6096cb74", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  60%|    | 15/25 [01:22&lt;00:50,  5.05s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7f6ba46b5a0e4d76aa8a5c8fb12a72d5", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  64%|   | 16/25 [01:27&lt;00:45,  5.01s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a436c7b98ae44b7cb37f7b7abb9ec8bb", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  68%|   | 17/25 [01:32&lt;00:42,  5.25s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "cc8f58bc5f03409c8e9ad54e8e97f85f", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  72%|  | 18/25 [01:39&lt;00:38,  5.55s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d066d1b6a02c490d847f7bef895e0a38", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  76%|  | 19/25 [01:45&lt;00:35,  5.90s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "71435ef554be43d3a5418fa852ffa950", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  80%|  | 20/25 [01:52&lt;00:30,  6.17s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "5b73c30d2e344fba873ce3f1e692f2f2", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  84%| | 21/25 [01:59&lt;00:25,  6.28s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7e7d3e3a0c0f4c89811158958dd18a64", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  88%| | 22/25 [02:05&lt;00:18,  6.20s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e4be5ccd457c42efa39d8ef3b904b9b2", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  92%|| 23/25 [02:10&lt;00:12,  6.01s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "66179f9a3eb1481c9c612eb56fcfa286", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  96%|| 24/25 [02:16&lt;00:06,  6.07s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7ac0acc506c749e292a48fbccf3373cc", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...: 100%|| 25/25 [02:22&lt;00:00,  5.68s/it]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2344 tasks      | elapsed:    0.6s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    0.8s finished
</pre></div>
</div>
</div>
</div>
<section id="plot">
<h3>Plot<a class="headerlink" href="#plot" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pairs</span><span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">)]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">with</span> <span class="n">mplscience</span><span class="o">.</span><span class="n">style_context</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;Fraction removed&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;Uncertainty&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">uncertainty_full_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Type == &#39;Intrinsic&#39;&quot;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightblue&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Intrinsic Uncertainty&quot;</span><span class="p">)</span>
    <span class="c1"># annotator = Annotator(ax, pairs, data=df, x=x, y=y)</span>
    <span class="c1"># annotator.configure(test=&#39;Mann-Whitney&#39;, text_format=&#39;star&#39;, loc=&#39;inside&#39;)</span>
    <span class="c1"># annotator.apply_and_annotate()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="k">if</span> <span class="n">SAVE_FIGURES</span><span class="p">:</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="n">FIG_DIR</span> <span class="o">/</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="o">/</span> <span class="s1">&#39;pancreas_noise&#39;</span> <span class="o">/</span> <span class="s1">&#39;intrinsic_downsampling.svg&#39;</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span>
        <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span>
    <span class="p">)</span>    

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">with</span> <span class="n">mplscience</span><span class="o">.</span><span class="n">style_context</span><span class="p">():</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">uncertainty_full_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Type == &#39;Extrinsic&#39;&quot;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgreen&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Extrinsic Uncertainty&quot;</span><span class="p">)</span>
    <span class="c1"># annotator = Annotator(ax, pairs, data=df, x=x, y=y)</span>
    <span class="c1"># annotator.configure(test=&#39;Mann-Whitney&#39;, text_format=&#39;star&#39;, loc=&#39;inside&#39;)</span>
    <span class="c1"># annotator.apply_and_annotate()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="k">if</span> <span class="n">SAVE_FIGURES</span><span class="p">:</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="n">FIG_DIR</span> <span class="o">/</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="o">/</span> <span class="s1">&#39;pancreas_noise&#39;</span> <span class="o">/</span> <span class="s1">&#39;extrinsic_downsampling.svg&#39;</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span>
        <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span>
    <span class="p">)</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/900a61fc3c2f96f454bc972b75a9e68bab72e5031efd8a32cc1a834bac781373.png" src="../_images/900a61fc3c2f96f454bc972b75a9e68bab72e5031efd8a32cc1a834bac781373.png" />
<img alt="../_images/8b7bab184c89bcd4355b96a3639f3665da4dc9e38eb64e8fb08d0a92a2e1ca93.png" src="../_images/8b7bab184c89bcd4355b96a3639f3665da4dc9e38eb64e8fb08d0a92a2e1ca93.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="s2">&quot;Sulf2&quot;</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="k">with</span> <span class="n">mplscience</span><span class="o">.</span><span class="n">style_context</span><span class="p">():</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ad</span><span class="p">),</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">perturbed_adatas</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">axarr</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
        <span class="n">scv</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ad</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;UMI library removed: </span><span class="si">{</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="k">if</span> <span class="n">SAVE_FIGURES</span><span class="p">:</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="n">FIG_DIR</span> <span class="o">/</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="o">/</span> <span class="s1">&#39;pancreas_noise&#39;</span> <span class="o">/</span> <span class="s1">&#39;genes_downsampling.svg&#39;</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span>
        <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span>
    <span class="p">)</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/5af8f11233b4b863f988113c33a53e6d8b6ccec9657890e3b3b627412e1c25ce.png" src="../_images/5af8f11233b4b863f988113c33a53e6d8b6ccec9657890e3b3b627412e1c25ce.png" />
</div>
</div>
</section>
</section>
<section id="unspliced-dropout">
<h2>Unspliced dropout<a class="headerlink" href="#unspliced-dropout" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata</span> <span class="o">=</span> <span class="n">scv</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">pancreas</span><span class="p">(</span><span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;pancreas&quot;</span> <span class="o">/</span> <span class="s2">&quot;endocrinogenesis_day15.h5ad&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uncertainty_full_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Uncertainty&quot;</span><span class="p">,</span> <span class="s2">&quot;Dropout probability&quot;</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;Num genes&quot;</span><span class="p">])</span>
<span class="n">perturbed_adatas</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">fracs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">]</span>
<span class="n">n_genes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">800</span><span class="p">]</span>

<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">n_genes</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">fracs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">s</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">bdata</span> <span class="o">=</span> <span class="n">dropout_unspliced_gene</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">genes_to_use</span><span class="o">=</span><span class="n">genes_to_use</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bdata</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">bdata</span> <span class="o">=</span> <span class="n">preprocess_data</span><span class="p">(</span><span class="n">bdata</span><span class="p">,</span> <span class="n">min_max_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">filter_on_r2</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">perturbed_adatas</span><span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="n">g</span><span class="p">)]</span> <span class="o">=</span> <span class="n">bdata</span>
        <span class="n">VELOVI</span><span class="o">.</span><span class="n">setup_anndata</span><span class="p">(</span><span class="n">bdata</span><span class="p">,</span> <span class="n">spliced_layer</span><span class="o">=</span><span class="s2">&quot;Ms&quot;</span><span class="p">,</span> <span class="n">unspliced_layer</span><span class="o">=</span><span class="s2">&quot;Mu&quot;</span><span class="p">)</span>
        <span class="n">vae</span> <span class="o">=</span> <span class="n">VELOVI</span><span class="p">(</span><span class="n">bdata</span><span class="p">)</span>
        <span class="n">vae</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="n">uncertainty_df</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">vae</span><span class="o">.</span><span class="n">get_directional_uncertainty</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">extrinsic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">compute_extrinisic_uncertainty</span><span class="p">(</span><span class="n">bdata</span><span class="p">,</span> <span class="n">vae</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">25</span><span class="p">))</span>
        <span class="n">intrinsic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">uncertainty_df</span><span class="o">.</span><span class="n">directional_cosine_sim_variance</span><span class="p">)</span>
        <span class="n">unc_type</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Intrinsic&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">intrinsic</span><span class="p">)</span> 
        <span class="n">unc_type</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;Extrinsic&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">extrinsic</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">intrinsic</span><span class="p">,</span> <span class="n">extrinsic</span><span class="p">])</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Dropout probability&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unc_type</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Num genes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">uncertainty_full_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">uncertainty_full_df</span><span class="p">,</span> <span class="n">df</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
    finished (0:00:00) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:00) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 485/500:  97%|| 485/500 [01:27&lt;00:02,  5.56it/s, loss=-2.41e+03, v_num=1]
Monitored metric elbo_validation did not improve in the last 45 records. Best score: -2342.135. Signaling Trainer to stop.
<span class=" -Color -Color-Blue">INFO    </span> velovi: Sampling from model<span class=" -Color -Color-Yellow">...</span>                                                                            
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2008 tasks      | elapsed:    1.7s
[Parallel(n_jobs=-1)]: Done 3612 tasks      | elapsed:    3.0s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    3.0s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   0%|          | 0/25 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f5c1bafe8eae4f33bb807c368f067fb1", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   4%|         | 1/25 [00:05&lt;02:09,  5.40s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7d9c1c54a5634d308ed0f1baecf66ade", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   8%|         | 2/25 [00:10&lt;01:59,  5.20s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3729ff95adaf48d4bbbefbd92b1a00c9", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  12%|        | 3/25 [00:15&lt;01:55,  5.26s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d78e4fe97c354c31ad595fb4417e1f3c", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  16%|        | 4/25 [00:20&lt;01:48,  5.16s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "59b68284e16644c18cc03dcf55acfcb9", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  20%|        | 5/25 [00:26&lt;01:43,  5.19s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "21aa2cdd080e417ea5a1f1b10a774238", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  24%|       | 6/25 [00:31&lt;01:38,  5.17s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ea01bf6638c54a00932954de37b96ef9", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  28%|       | 7/25 [00:36&lt;01:32,  5.16s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "8a94780d4f1c4fc28b6d67e15b0a51b4", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  32%|      | 8/25 [00:41&lt;01:26,  5.10s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3ad5d8486e204ee9987f1737ff000191", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  36%|      | 9/25 [00:46&lt;01:22,  5.16s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "427b188adad74b9eaceb0d9cee8f933f", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  40%|      | 10/25 [00:51&lt;01:16,  5.09s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e271e92b93dd4f9285de55bf06b3c24d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  44%|     | 11/25 [00:56&lt;01:12,  5.15s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6b84e418285848afa038489c69f60182", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  48%|     | 12/25 [01:01&lt;01:06,  5.14s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "447e5619c93f4e8ba9362af2f713dfc5", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  52%|    | 13/25 [01:03&lt;00:49,  4.16s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3c23d1814d684f8b8a756c758a653e4e", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  56%|    | 14/25 [01:08&lt;00:49,  4.47s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9c380a329d3e4685863cf5aa9b959a76", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  60%|    | 15/25 [01:14&lt;00:46,  4.69s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "996b880b7ce94d2cbf19c03e06f6771f", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  64%|   | 16/25 [01:19&lt;00:43,  4.82s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "320e15f8d74b4db3bf75380ba829eebf", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  68%|   | 17/25 [01:24&lt;00:38,  4.81s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "82e4904618eb4e259e21eb1f0263a572", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  72%|  | 18/25 [01:29&lt;00:33,  4.84s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "4de4f9c33c0a4d73acfd795c8ea50cc6", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  76%|  | 19/25 [01:34&lt;00:29,  4.93s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "569b2c0bb2264f978fc865be59c99aeb", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  80%|  | 20/25 [01:39&lt;00:24,  4.96s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "4d623c423a2e422b8dffb93c2f55c7d1", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  84%| | 21/25 [01:44&lt;00:19,  4.94s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "97bab3208dce4339aa3802609dcbde86", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  88%| | 22/25 [01:49&lt;00:14,  4.95s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "8b9eb826ca1d457c8d278dd7cdf5e4ee", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  92%|| 23/25 [01:54&lt;00:10,  5.03s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7c30971570db4f3890f02d07dedc1853", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  96%|| 24/25 [01:59&lt;00:05,  5.06s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7c3ec1b0fde34d24a8d8ed4e43ed724b", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...: 100%|| 25/25 [02:04&lt;00:00,  4.98s/it]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2398 tasks      | elapsed:    0.6s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    0.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
    finished (0:00:00) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:00) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 500/500: 100%|| 500/500 [01:29&lt;00:00,  5.58it/s, loss=-2.48e+03, v_num=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`Trainer.fit` stopped: `max_epochs=500` reached.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 500/500: 100%|| 500/500 [01:29&lt;00:00,  5.57it/s, loss=-2.48e+03, v_num=1]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Sampling from model<span class=" -Color -Color-Yellow">...</span>                                                                            
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.2s
[Parallel(n_jobs=-1)]: Done 2008 tasks      | elapsed:    1.6s
[Parallel(n_jobs=-1)]: Done 3612 tasks      | elapsed:    2.8s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    2.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   0%|          | 0/25 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "dc2d0d02ae1648e2b55ef11b08bb02ec", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   4%|         | 1/25 [00:05&lt;02:05,  5.21s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "80353c78d4ff4ebe96fb2a44f36a0242", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   8%|         | 2/25 [00:09&lt;01:52,  4.87s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ec261dda4d8044768d0b8ca519fe38d4", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  12%|        | 3/25 [00:14&lt;01:41,  4.62s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d8b2d9be96fe4b52bbfcf53259af6ba1", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  16%|        | 4/25 [00:19&lt;01:38,  4.71s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "fdf77437bf2a424181823dedc57587c9", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  20%|        | 5/25 [00:24&lt;01:37,  4.88s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6f3f5e2eb30e4a82ab69f7f2cf235fce", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  24%|       | 6/25 [00:28&lt;01:31,  4.80s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "19f720ecad004cbf98e431e6f66fc787", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  28%|       | 7/25 [00:33&lt;01:28,  4.90s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e6848f13e01744cfbffb5f3fcb9a7e58", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  32%|      | 8/25 [00:39&lt;01:25,  5.02s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e404652c8d314a38ac6dd2fa5458581d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  36%|      | 9/25 [00:43&lt;01:19,  4.94s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "33cd1db9b75d4199b638fb630a53c54b", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  40%|      | 10/25 [00:49&lt;01:14,  4.99s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b68965b0df7649429510edbcb7eb44ef", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  44%|     | 11/25 [00:53&lt;01:09,  4.96s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d1367ce87a67479892ddb32228765349", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  48%|     | 12/25 [00:59&lt;01:05,  5.02s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "270eea3f8e4c4313bf6dd64883ba8738", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  52%|    | 13/25 [01:04&lt;01:00,  5.04s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f37298911a584f44a13f1b62657a72b6", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  56%|    | 14/25 [01:09&lt;00:56,  5.13s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "16522fac8a1e48219d83d4e6d85e0749", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  60%|    | 15/25 [01:14&lt;00:49,  4.96s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7a2f33d778f3489db1645b28e34341f8", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  64%|   | 16/25 [01:15&lt;00:36,  4.01s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "122601a319a142a29b291589d7e4a33d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  68%|   | 17/25 [01:18&lt;00:28,  3.55s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "8c272a1cabf94b07a9745910ca6efe02", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  72%|  | 18/25 [01:23&lt;00:27,  3.92s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f468d2de04174771aa14224070f3cadc", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  76%|  | 19/25 [01:28&lt;00:25,  4.28s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "17963eee9710433cb00a0b74d257c824", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  80%|  | 20/25 [01:33&lt;00:22,  4.53s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "4a2d1b64d0084f1cb338897e35a733fd", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  84%| | 21/25 [01:35&lt;00:15,  3.88s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e12d098f277945f09bd2b02655c09647", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  88%| | 22/25 [01:40&lt;00:12,  4.14s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d935e6d25aa34085859491957b2effc1", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  92%|| 23/25 [01:45&lt;00:08,  4.30s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "aea57fa32b664df7ae5beb1ab73dab0c", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  96%|| 24/25 [01:50&lt;00:04,  4.52s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "8459f284b0eb469f86e0553b019cf986", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...: 100%|| 25/25 [01:55&lt;00:00,  4.62s/it]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2371 tasks      | elapsed:    0.6s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    0.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
    finished (0:00:00) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:00) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 455/500:  91%| | 455/500 [01:18&lt;00:07,  5.77it/s, loss=-2.78e+03, v_num=1]
Monitored metric elbo_validation did not improve in the last 45 records. Best score: -2630.267. Signaling Trainer to stop.
<span class=" -Color -Color-Blue">INFO    </span> velovi: Sampling from model<span class=" -Color -Color-Yellow">...</span>                                                                            
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2008 tasks      | elapsed:    1.6s
[Parallel(n_jobs=-1)]: Done 3612 tasks      | elapsed:    2.8s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    2.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   0%|          | 0/25 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "76261f822b164fd4a498fcd79999ed97", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   4%|         | 1/25 [00:05&lt;02:08,  5.36s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7c6133b06cf841c1abb2ade011035934", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   8%|         | 2/25 [00:10&lt;01:59,  5.20s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7488b250f60e4025a591249863903f5a", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  12%|        | 3/25 [00:15&lt;01:53,  5.18s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "817912d0a6f54b49861f16682c120923", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  16%|        | 4/25 [00:20&lt;01:50,  5.26s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f42c1cf9ec5a4f74b12a30e659306adb", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  20%|        | 5/25 [00:23&lt;01:27,  4.39s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "df82538ec16e4ce39b627e6ab68edc7f", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  24%|       | 6/25 [00:28&lt;01:27,  4.62s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "19feea61db2a474986da9eda6b99e702", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  28%|       | 7/25 [00:34&lt;01:26,  4.79s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "4ab5cd81d7ab4208954e1663d6cf91ca", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  32%|      | 8/25 [00:38&lt;01:22,  4.83s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1070953a29bb40189960be1cdba74452", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  36%|      | 9/25 [00:43&lt;01:17,  4.86s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e484794366eb446d9daa4f4355d67784", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  40%|      | 10/25 [00:49&lt;01:14,  4.96s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "72b34d2685924173a0885b4b44e1343d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  44%|     | 11/25 [00:54&lt;01:10,  5.04s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d267c99d4cd24820b9938aee1806c5f3", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  48%|     | 12/25 [00:59&lt;01:04,  4.94s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "72000d2b4fcc4f9f9d7604cda17ce201", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  52%|    | 13/25 [01:04&lt;01:00,  5.02s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "eb1c3cd2d0f841e3951022acdd3ff636", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  56%|    | 14/25 [01:09&lt;00:56,  5.17s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "37dba239feb14641be7e7b76af1404f1", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  60%|    | 15/25 [01:14&lt;00:51,  5.13s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "8664dd52c3d743d8b469fba5417b930d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  64%|   | 16/25 [01:19&lt;00:46,  5.16s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "4e4e39ecb5774470882af1a208f0916a", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  68%|   | 17/25 [01:25&lt;00:41,  5.16s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ace892c78b2a454c9cf708af633a8eb4", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  72%|  | 18/25 [01:29&lt;00:34,  4.95s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b6a8d8660292442faed440a3fc3f9b23", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  76%|  | 19/25 [01:34&lt;00:30,  5.04s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d4a53cf2e3344a198732715479133614", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  80%|  | 20/25 [01:40&lt;00:25,  5.08s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a92473a22e9b48c2807bd1bd8932e6d8", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  84%| | 21/25 [01:44&lt;00:20,  5.05s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3116c502158b4a378e64037006cdb64d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  88%| | 22/25 [01:50&lt;00:15,  5.12s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "63de03dfdd6246e0bb945a747d107a88", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  92%|| 23/25 [01:55&lt;00:10,  5.10s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "311e56c49e7f4db3ba51e84b63bad33c", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  96%|| 24/25 [02:00&lt;00:05,  5.11s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e73011fc07e14ff2a3c2a893cf7d1004", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...: 100%|| 25/25 [02:04&lt;00:00,  4.99s/it]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2371 tasks      | elapsed:    0.6s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    0.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
    finished (0:00:00) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:00) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 500/500: 100%|| 500/500 [01:28&lt;00:00,  5.65it/s, loss=-3.28e+03, v_num=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`Trainer.fit` stopped: `max_epochs=500` reached.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 500/500: 100%|| 500/500 [01:28&lt;00:00,  5.63it/s, loss=-3.28e+03, v_num=1]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Sampling from model<span class=" -Color -Color-Yellow">...</span>                                                                            
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.2s
[Parallel(n_jobs=-1)]: Done 2008 tasks      | elapsed:    1.6s
[Parallel(n_jobs=-1)]: Done 3612 tasks      | elapsed:    2.8s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    2.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   0%|          | 0/25 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "053619f0b6d348d493e2bc313b5954af", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   4%|         | 1/25 [00:04&lt;01:58,  4.94s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "bd8953d4982c44c0b23fd915c6bb5eff", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   8%|         | 2/25 [00:10&lt;01:56,  5.05s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "caab51006bb3491ebf98b7ec7359d516", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  12%|        | 3/25 [00:15&lt;01:52,  5.12s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "fe8bef4437ec46c4846989977fa6d282", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  16%|        | 4/25 [00:20&lt;01:45,  5.04s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "56beb25ab14c46d79f1126ba06c7bd89", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  20%|        | 5/25 [00:24&lt;01:38,  4.93s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b693ed83cfa944818cbf1ec7deab802f", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  24%|       | 6/25 [00:30&lt;01:35,  5.00s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "5c19708a994340c8bbbcdb914244e94c", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  28%|       | 7/25 [00:35&lt;01:31,  5.10s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b6fc2c58694c4471b0579ec57e984871", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  32%|      | 8/25 [00:40&lt;01:26,  5.08s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1000d16082eb468195e5a7af5c028994", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  36%|      | 9/25 [00:45&lt;01:21,  5.07s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f417e14dbb2f4a128759f5a3ebcb0c40", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  40%|      | 10/25 [00:50&lt;01:16,  5.12s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "16b2c369b57b43c7a6c65a2e90689b33", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  44%|     | 11/25 [00:54&lt;01:08,  4.87s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "26031700a6f443fb9ea27f373b565a8a", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  48%|     | 12/25 [00:59&lt;01:03,  4.91s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "97fe8e2481f146e69746381f62b73fb6", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  52%|    | 13/25 [01:05&lt;00:59,  4.98s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "12e9aef60c69430b9b694ad8c8feb8ff", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  56%|    | 14/25 [01:10&lt;00:55,  5.06s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d24f818c7d8a4e85b5b3b8b6738eb012", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  60%|    | 15/25 [01:15&lt;00:50,  5.08s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "2f8a26ff1a1544d582ff0a17eee60e6d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  64%|   | 16/25 [01:20&lt;00:44,  4.99s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3e7f8671a8fd41ed933011c5e57a094d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  68%|   | 17/25 [01:23&lt;00:36,  4.54s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6845ef6b843546659337aa097d10964e", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  72%|  | 18/25 [01:29&lt;00:33,  4.80s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "45a3e661ca0447fd8df58973253d6def", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  76%|  | 19/25 [01:34&lt;00:29,  4.94s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "209bda6f6a7445779b6d9bd9027b4b6e", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  80%|  | 20/25 [01:39&lt;00:25,  5.02s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b15413c8bf29478d9b8917fd38407dd8", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  84%| | 21/25 [01:44&lt;00:20,  5.03s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a7b76b1e80b546148c7921d4777664cf", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  88%| | 22/25 [01:48&lt;00:14,  4.79s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7ad041e2f573476aa319301c53bb1222", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  92%|| 23/25 [01:54&lt;00:09,  4.96s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1e290ae363b44dafabc53554e5c7145d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  96%|| 24/25 [01:59&lt;00:04,  4.96s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "309a85bdadce481b8937d7ca80733351", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...: 100%|| 25/25 [02:04&lt;00:00,  4.96s/it]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2398 tasks      | elapsed:    0.6s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    0.8s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
    finished (0:00:00) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:00) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 341/500:  68%|   | 341/500 [01:00&lt;00:28,  5.65it/s, loss=-2.39e+03, v_num=1]
Monitored metric elbo_validation did not improve in the last 45 records. Best score: -2320.523. Signaling Trainer to stop.
<span class=" -Color -Color-Blue">INFO    </span> velovi: Sampling from model<span class=" -Color -Color-Yellow">...</span>                                                                            
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.2s
[Parallel(n_jobs=-1)]: Done 2008 tasks      | elapsed:    1.7s
[Parallel(n_jobs=-1)]: Done 3612 tasks      | elapsed:    3.1s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    3.1s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   0%|          | 0/25 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "87a7a3e9708c4f309bf49665498b0c30", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   4%|         | 1/25 [00:05&lt;02:04,  5.21s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "18e2dbd217864dea914e64c8d66db6a6", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   8%|         | 2/25 [00:10&lt;02:00,  5.22s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b2dd528bbca54470a8b0facd59973ad2", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  12%|        | 3/25 [00:15&lt;01:54,  5.22s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "853dcf7a32b34fd4a10f7d7c08bca715", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  16%|        | 4/25 [00:20&lt;01:49,  5.23s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c12af90b44fc48648c2fe08695bbc374", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  20%|        | 5/25 [00:26&lt;01:44,  5.22s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c43e47a5eceb449bb5ab4452bf881163", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  24%|       | 6/25 [00:31&lt;01:37,  5.12s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d300fc560d2441baabc8e7d2ea831a8d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  28%|       | 7/25 [00:36&lt;01:34,  5.22s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b28adc7bf05149999eea439112c61e20", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  32%|      | 8/25 [00:41&lt;01:25,  5.05s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7f50ae2187b74e7f97c3ffd7ee5c6917", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  36%|      | 9/25 [00:46&lt;01:21,  5.12s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7e670df1ab2844ad94f92a06747364d0", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  40%|      | 10/25 [00:51&lt;01:18,  5.21s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "54df6d9d30484ef18080b1a1924613b2", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  44%|     | 11/25 [00:56&lt;01:11,  5.14s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "0c3308adca73410d9872297ebb2141ab", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  48%|     | 12/25 [01:01&lt;01:06,  5.13s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "5f26de81ce6d429593b749aff538993e", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  52%|    | 13/25 [01:05&lt;00:57,  4.76s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "2039d5def4704261b1b47e91e85fec92", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  56%|    | 14/25 [01:10&lt;00:52,  4.76s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ed9e231a928846768afd56fd5797f10d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  60%|    | 15/25 [01:15&lt;00:49,  4.94s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "66589409f14f4299a4877981a11871d2", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  64%|   | 16/25 [01:21&lt;00:45,  5.06s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c5e52a7c61c04ab9bcc3270cd34c2f29", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  68%|   | 17/25 [01:24&lt;00:35,  4.39s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6c85d4a623024d0d8d5178c138a0d3f4", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  72%|  | 18/25 [01:29&lt;00:31,  4.54s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "4908b8e444c44a1e81e2f95ad4da513e", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  76%|  | 19/25 [01:34&lt;00:28,  4.78s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "cf26c7133bf54b3cad5f57b02a5a7e6f", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  80%|  | 20/25 [01:39&lt;00:23,  4.75s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "dca594db66b149c48fcc90fbb2e40957", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  84%| | 21/25 [01:44&lt;00:19,  4.84s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6a546eb419014513aec4c2de230229f7", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  88%| | 22/25 [01:49&lt;00:14,  4.91s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c10ad40b28ed41a89cf83a63fc2a24bf", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  92%|| 23/25 [01:54&lt;00:09,  4.99s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "fe31556e930243f4934093ef374d71fe", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  96%|| 24/25 [01:59&lt;00:04,  4.99s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "69adc55588a44c999debb466115885d4", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...: 100%|| 25/25 [02:04&lt;00:00,  4.98s/it]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2371 tasks      | elapsed:    0.6s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    0.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
    finished (0:00:00) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:00) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 500/500: 100%|| 500/500 [01:30&lt;00:00,  5.43it/s, loss=-2.54e+03, v_num=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`Trainer.fit` stopped: `max_epochs=500` reached.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 500/500: 100%|| 500/500 [01:30&lt;00:00,  5.50it/s, loss=-2.54e+03, v_num=1]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Sampling from model<span class=" -Color -Color-Yellow">...</span>                                                                            
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2008 tasks      | elapsed:    1.6s
[Parallel(n_jobs=-1)]: Done 3612 tasks      | elapsed:    2.8s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    2.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   0%|          | 0/25 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9c409e048e6147e8a142fc5d89ee6b3d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   4%|         | 1/25 [00:05&lt;02:06,  5.26s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6145afbfa93d45abbeb6f0e78ac81765", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   8%|         | 2/25 [00:10&lt;02:00,  5.22s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3834cb78cd884863831011a2803dc994", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  12%|        | 3/25 [00:15&lt;01:55,  5.26s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b0dca06d22de413d8fffeda7dbbc7f0e", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  16%|        | 4/25 [00:20&lt;01:48,  5.19s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "47c91470fbd54a3a9d9426a3b4777abb", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  20%|        | 5/25 [00:25&lt;01:42,  5.13s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "584a2033ba2e4f5592ed6eb3be247c23", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  24%|       | 6/25 [00:30&lt;01:36,  5.10s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "0cf3711917b843e082d5c2a2a2ec256a", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  28%|       | 7/25 [00:35&lt;01:31,  5.06s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e574978f73ef43cbb20f07b395f1e0a5", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  32%|      | 8/25 [00:41&lt;01:27,  5.17s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "724d7f71bcbb486b90aaba895ec06530", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  36%|      | 9/25 [00:46&lt;01:22,  5.15s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "65a734357b28472680e7a6409d3ad65f", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  40%|      | 10/25 [00:51&lt;01:15,  5.06s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "92e9b9f3a7844ff9992cfdccb2d2c26c", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  44%|     | 11/25 [00:56&lt;01:11,  5.11s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "5ec0522302444b93a50b15c5645daf59", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  48%|     | 12/25 [01:01&lt;01:06,  5.14s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d62fcd0a6346473ea7c3575d04636cee", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  52%|    | 13/25 [01:06&lt;00:59,  4.94s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f84128f2a9d8433889ddd14abb1e9e12", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  56%|    | 14/25 [01:11&lt;00:55,  5.06s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b20bdf477cd142be8ecbfc9a2e2a6455", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  60%|    | 15/25 [01:16&lt;00:50,  5.05s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "86307c715b05447bbeb2c40753295766", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  64%|   | 16/25 [01:21&lt;00:44,  4.99s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "897badd845f14e488ce9a8b637bed923", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  68%|   | 17/25 [01:26&lt;00:40,  5.05s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d4e545e27cfb49e586e4f720d3786122", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  72%|  | 18/25 [01:31&lt;00:35,  5.12s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "2ec9e17e85634f2082d443f8fc17aa47", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  76%|  | 19/25 [01:36&lt;00:29,  4.89s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "49b6dbbaa3e049d2b103a3d8bb657310", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  80%|  | 20/25 [01:41&lt;00:24,  5.00s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "85a94d45f8d4425381d4cc3845892beb", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  84%| | 21/25 [01:46&lt;00:19,  4.99s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9584740d30a4491b9c4899eea9524733", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  88%| | 22/25 [01:51&lt;00:15,  5.06s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "bfa251d365b144a59032f6fe5d8a6831", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  92%|| 23/25 [01:55&lt;00:09,  4.77s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "748335b2debe44c8afc34bd0a005f0c4", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  96%|| 24/25 [02:00&lt;00:04,  4.86s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6518e43e5fbe4c58970db2ee7e6f4d87", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...: 100%|| 25/25 [02:04&lt;00:00,  4.99s/it]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2371 tasks      | elapsed:    0.6s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    0.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
    finished (0:00:00) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:00) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 359/500:  72%|  | 359/500 [01:06&lt;00:26,  5.41it/s, loss=-3.11e+03, v_num=1]
Monitored metric elbo_validation did not improve in the last 45 records. Best score: -2891.805. Signaling Trainer to stop.
<span class=" -Color -Color-Blue">INFO    </span> velovi: Sampling from model<span class=" -Color -Color-Yellow">...</span>                                                                            
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2008 tasks      | elapsed:    1.7s
[Parallel(n_jobs=-1)]: Done 3612 tasks      | elapsed:    2.8s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    2.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   0%|          | 0/25 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "5c47191530b64adfb8e16e1690e1d5da", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   4%|         | 1/25 [00:05&lt;02:08,  5.37s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7f3e1f1eb0b0446abb8703bb5bd6e1de", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   8%|         | 2/25 [00:07&lt;01:25,  3.71s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6dad6badb7324e86bc48d340168bfb90", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  12%|        | 3/25 [00:13&lt;01:37,  4.44s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d28f61796e1241e3a6769873bd35ac2d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  16%|        | 4/25 [00:18&lt;01:40,  4.79s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "4076cc71ddd04afe8e436392c47d2df9", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  20%|        | 5/25 [00:21&lt;01:25,  4.26s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9ffcac5709754b9f83273a0d64ea66e4", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  24%|       | 6/25 [00:27&lt;01:26,  4.57s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "71af53456b2e41fa97be32d2f5f024fb", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  28%|       | 7/25 [00:32&lt;01:25,  4.78s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "62e08fd222574a37826f632138c92128", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  32%|      | 8/25 [00:37&lt;01:24,  4.96s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "839c40cb4d934827a91dc5f14173e424", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  36%|      | 9/25 [00:42&lt;01:21,  5.08s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "420d3edb553346e6ad5b5bb43f736846", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  40%|      | 10/25 [00:48&lt;01:16,  5.11s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "297ca9d201714041b8b94484de81b345", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  44%|     | 11/25 [00:53&lt;01:11,  5.12s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "49ab840d811b48a999670a4aeae401b4", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  48%|     | 12/25 [00:58&lt;01:07,  5.15s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "5902bcb0d839425ba64ae66d8784b348", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  52%|    | 13/25 [01:03&lt;01:01,  5.16s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "314f88a6ddbd47fe8df91bbe092f650d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  56%|    | 14/25 [01:08&lt;00:56,  5.11s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6644a4cf05284d56b34af23b13e01be7", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  60%|    | 15/25 [01:13&lt;00:49,  4.95s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1c0b5ab1c4e4401c9b0bb4f2f034e434", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  64%|   | 16/25 [01:18&lt;00:45,  5.11s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "88d8fa6db3c44a6f8f0dfc8f8ca7d9ea", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  68%|   | 17/25 [01:24&lt;00:41,  5.16s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7862ae9290bc421bad064feda224c490", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  72%|  | 18/25 [01:29&lt;00:36,  5.17s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9b222a1471224a2c9373a9ce2fe96e83", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  76%|  | 19/25 [01:34&lt;00:30,  5.10s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "96f717f6f719415ba55650a314bbc03a", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  80%|  | 20/25 [01:39&lt;00:25,  5.08s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f6cbcfdf5c584b4dbd0d820aea9d24e9", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  84%| | 21/25 [01:44&lt;00:20,  5.09s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b9e3afe533d346a2a956a3818878da7b", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  88%| | 22/25 [01:49&lt;00:15,  5.11s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "518d7f60d84d4e33b7793d59968af2a6", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  92%|| 23/25 [01:54&lt;00:10,  5.05s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "52c616a546634bc98e4098db69eaa3e7", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  96%|| 24/25 [01:56&lt;00:04,  4.14s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "4adc1a26e350465b92b5bfee74a93fd3", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...: 100%|| 25/25 [02:01&lt;00:00,  4.86s/it]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2371 tasks      | elapsed:    0.6s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    0.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
    finished (0:00:00) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:00) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 340/500:  68%|   | 340/500 [01:01&lt;00:29,  5.49it/s, loss=-3.99e+03, v_num=1]
Monitored metric elbo_validation did not improve in the last 45 records. Best score: -3599.325. Signaling Trainer to stop.
<span class=" -Color -Color-Blue">INFO    </span> velovi: Sampling from model<span class=" -Color -Color-Yellow">...</span>                                                                            
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2008 tasks      | elapsed:    1.6s
[Parallel(n_jobs=-1)]: Done 3612 tasks      | elapsed:    2.8s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    2.8s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   0%|          | 0/25 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "74f01401c8654878a8ce0f18c26fb757", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   4%|         | 1/25 [00:02&lt;00:57,  2.42s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e3cef7ea78af49a4827eeada69452c3d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   8%|         | 2/25 [00:07&lt;01:33,  4.05s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "fd6fab9ce3f64aa9b2d736f6e8f41f9f", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  12%|        | 3/25 [00:12&lt;01:39,  4.54s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "2a54eac267af4e278edb31d195d9d3a5", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  16%|        | 4/25 [00:17&lt;01:38,  4.69s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3198b610ac8e4cba8beee5d1eb63666c", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  20%|        | 5/25 [00:21&lt;01:31,  4.56s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d57ae0e6cc4a4aa0b92aaf042f43ce48", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  24%|       | 6/25 [00:27&lt;01:30,  4.75s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e9fd621bc1cc47f8ba8a26f31d20131c", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  28%|       | 7/25 [00:32&lt;01:27,  4.88s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "eedcf2c4d98b4773839f4da71a3d5cfe", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  32%|      | 8/25 [00:37&lt;01:25,  5.04s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "adc12d6b6a984b8cb499dfb7915fcec4", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  36%|      | 9/25 [00:42&lt;01:20,  5.05s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "73ec0cf10dfe4d378665cf6002c3ff14", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  40%|      | 10/25 [00:47&lt;01:15,  5.05s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c626014efb5c4798ae8f4accd2e9ddd6", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  44%|     | 11/25 [00:52&lt;01:11,  5.09s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "fc27bcee2a104b3b8ac3df773949244b", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  48%|     | 12/25 [00:58&lt;01:06,  5.11s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a919a72bd8ce45098da4e8dc1ce4d52a", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  52%|    | 13/25 [01:03&lt;01:02,  5.18s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d5a3b39223b047cfa31b510ff6117e18", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  56%|    | 14/25 [01:08&lt;00:56,  5.14s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "2bc400f9840f4d49b64a7aa0e0e01c92", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  60%|    | 15/25 [01:12&lt;00:47,  4.71s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6a30a5826afd411d88adea9c236c3f6f", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  64%|   | 16/25 [01:17&lt;00:42,  4.77s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "54fcd5c12ab74dc6ae35b8b841a9d757", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  68%|   | 17/25 [01:21&lt;00:38,  4.79s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "324b25f97a0f4c93bcbf627e97375a7e", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  72%|  | 18/25 [01:25&lt;00:31,  4.50s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7a7f34048b6b4f35a4b98281f62851d9", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  76%|  | 19/25 [01:30&lt;00:28,  4.70s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "cca8d95c0d6c4b22b11b76bcbaf1945c", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  80%|  | 20/25 [01:35&lt;00:23,  4.67s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c4a0d334f26f42e7b5dcffdb317120e9", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  84%| | 21/25 [01:40&lt;00:18,  4.65s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c042df4940ee460b9bba43c1ad654a82", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  88%| | 22/25 [01:45&lt;00:14,  4.77s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f6d834ab8e814081a08ef7ad463322c0", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  92%|| 23/25 [01:50&lt;00:09,  4.95s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "77f97416da3842feb76dd9a595c3ee7a", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  96%|| 24/25 [01:55&lt;00:04,  4.85s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ab6e4d222d854f03a9fd0c23d42000d5", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...: 100%|| 25/25 [01:58&lt;00:00,  4.75s/it]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2371 tasks      | elapsed:    0.6s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    0.9s finished
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h3>Plot<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pairs</span><span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">with</span> <span class="n">mplscience</span><span class="o">.</span><span class="n">style_context</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;Num genes&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;Uncertainty&quot;</span>
    <span class="n">hue</span> <span class="o">=</span> <span class="s2">&quot;Dropout probability&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">uncertainty_full_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Type == &#39;Intrinsic&#39;&quot;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightblue&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Intrinsic Uncertainty&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c1"># annotator = Annotator(ax, pairs, data=df, x=x, y=y)</span>
    <span class="c1"># annotator.configure(test=&#39;Mann-Whitney&#39;, text_format=&#39;star&#39;, loc=&#39;inside&#39;)</span>
    <span class="c1"># annotator.apply_and_annotate()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="k">if</span> <span class="n">SAVE_FIGURES</span><span class="p">:</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="n">FIG_DIR</span> <span class="o">/</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="o">/</span> <span class="s1">&#39;pancreas_noise&#39;</span> <span class="o">/</span> <span class="s1">&#39;intrinsic_dropout.svg&#39;</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span>
        <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span>
    <span class="p">)</span>    


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">with</span> <span class="n">mplscience</span><span class="o">.</span><span class="n">style_context</span><span class="p">():</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">uncertainty_full_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Type == &#39;Extrinsic&#39;&quot;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">hue</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgreen&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Extrinsic Uncertainty&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c1"># annotator = Annotator(ax, pairs, data=df, x=x, y=y)</span>
    <span class="c1"># annotator.configure(test=&#39;Mann-Whitney&#39;, text_format=&#39;star&#39;, loc=&#39;inside&#39;)</span>
    <span class="c1"># annotator.apply_and_annotate()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="k">if</span> <span class="n">SAVE_FIGURES</span><span class="p">:</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="n">FIG_DIR</span> <span class="o">/</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="o">/</span> <span class="s1">&#39;pancreas_noise&#39;</span> <span class="o">/</span> <span class="s1">&#39;extrinsic_dropout.svg&#39;</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span>
        <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span>
    <span class="p">)</span>        
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/seaborn/categorical.py:381: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
  if LooseVersion(mpl.__version__) &lt; &quot;3.0&quot;:
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/setuptools/_distutils/version.py:346: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
  other = LooseVersion(other)
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/seaborn/categorical.py:381: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
  if LooseVersion(mpl.__version__) &lt; &quot;3.0&quot;:
/home/adam/miniconda3/envs/velovi/lib/python3.10/site-packages/setuptools/_distutils/version.py:346: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
  other = LooseVersion(other)
</pre></div>
</div>
<img alt="../_images/7a1abe8d1e5cbe0d0b46893db51d02b495311b9e4d14755739f9d941adf46d29.png" src="../_images/7a1abe8d1e5cbe0d0b46893db51d02b495311b9e4d14755739f9d941adf46d29.png" />
<img alt="../_images/834080edb586913f942a3fbea04dfe4d850c9fc30be1fe5fb5ad386fdea15aac.png" src="../_images/834080edb586913f942a3fbea04dfe4d850c9fc30be1fe5fb5ad386fdea15aac.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">perturbed_adatas</span><span class="p">[(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">800</span><span class="p">)]</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;scaled_gene == True&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="k">with</span> <span class="n">mplscience</span><span class="o">.</span><span class="n">style_context</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">fracs</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">axarr</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
        <span class="n">ad</span> <span class="o">=</span> <span class="n">perturbed_adatas</span><span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="mi">800</span><span class="p">)]</span>
        <span class="n">scv</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ad</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Dropout probability: </span><span class="si">{</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="k">if</span> <span class="n">SAVE_FIGURES</span><span class="p">:</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="n">FIG_DIR</span> <span class="o">/</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="o">/</span> <span class="s1">&#39;pancreas_noise&#39;</span> <span class="o">/</span> <span class="s1">&#39;genes_dropout.svg&#39;</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span>
        <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span>
    <span class="p">)</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fam135a
</pre></div>
</div>
<img alt="../_images/edd0e2502c45089a0d3a798c4da7521cd7b13e6479066c23484f964942f402f0.png" src="../_images/edd0e2502c45089a0d3a798c4da7521cd7b13e6479066c23484f964942f402f0.png" />
</div>
</div>
</section>
</section>
<section id="multiplicative-noise">
<h2>Multiplicative noise<a class="headerlink" href="#multiplicative-noise" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata</span> <span class="o">=</span> <span class="n">scv</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">pancreas</span><span class="p">(</span><span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;pancreas&quot;</span> <span class="o">/</span> <span class="s2">&quot;endocrinogenesis_day15.h5ad&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scales</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]</span>
<span class="n">uncertainty_full_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Uncertainty&quot;</span><span class="p">,</span> <span class="s2">&quot;Noise scale&quot;</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;Cell type&quot;</span><span class="p">])</span>
<span class="n">perturbed_adatas</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;dummy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;dummy&quot;</span>
<span class="n">ct</span> <span class="o">=</span> <span class="s2">&quot;dummy&quot;</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scales</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">s</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">bdata</span> <span class="o">=</span> <span class="n">add_noise_to_celltype</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span> <span class="n">ct</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">genes_to_use</span><span class="o">=</span><span class="n">genes_to_use</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bdata</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">bdata</span> <span class="o">=</span> <span class="n">preprocess_data</span><span class="p">(</span><span class="n">bdata</span><span class="p">,</span> <span class="n">min_max_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">filter_on_r2</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">perturbed_adatas</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">bdata</span>
    <span class="n">VELOVI</span><span class="o">.</span><span class="n">setup_anndata</span><span class="p">(</span><span class="n">bdata</span><span class="p">,</span> <span class="n">spliced_layer</span><span class="o">=</span><span class="s2">&quot;Ms&quot;</span><span class="p">,</span> <span class="n">unspliced_layer</span><span class="o">=</span><span class="s2">&quot;Mu&quot;</span><span class="p">)</span>
    <span class="n">vae</span> <span class="o">=</span> <span class="n">VELOVI</span><span class="p">(</span><span class="n">bdata</span><span class="p">)</span>
    <span class="n">vae</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="n">uncertainty_df</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">vae</span><span class="o">.</span><span class="n">get_directional_uncertainty</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">extrinsic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">compute_extrinisic_uncertainty</span><span class="p">(</span><span class="n">bdata</span><span class="p">,</span> <span class="n">vae</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">25</span><span class="p">))</span><span class="o">.</span><span class="n">values</span>
    <span class="n">intrinsic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">uncertainty_df</span><span class="o">.</span><span class="n">directional_cosine_sim_variance</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
    <span class="n">unc_type</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Intrinsic&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">intrinsic</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Extrinsic&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">extrinsic</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">intrinsic</span><span class="p">,</span> <span class="n">extrinsic</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Noise scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unc_type</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Cell type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">bdata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">bdata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">values</span><span class="p">])</span>
    <span class="n">uncertainty_full_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">uncertainty_full_df</span><span class="p">,</span> <span class="n">df</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
    finished (0:00:00) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:00) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 464/500:  93%|| 464/500 [01:24&lt;00:06,  5.50it/s, loss=-2.39e+03, v_num=1]
Monitored metric elbo_validation did not improve in the last 45 records. Best score: -2318.713. Signaling Trainer to stop.
<span class=" -Color -Color-Blue">INFO    </span> velovi: Sampling from model<span class=" -Color -Color-Yellow">...</span>                                                                            
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2008 tasks      | elapsed:    1.7s
[Parallel(n_jobs=-1)]: Done 3612 tasks      | elapsed:    2.8s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    2.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   0%|          | 0/25 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "eeafe19c59bd47b7b0dd0ee833630254", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   4%|         | 1/25 [00:05&lt;02:03,  5.14s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3e7a34a92068438783e8d61621219258", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   8%|         | 2/25 [00:10&lt;01:56,  5.05s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "272a30fe35d74cd1bc0baaf94bc4991d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  12%|        | 3/25 [00:15&lt;01:52,  5.12s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "15f05deada0b45d29d74a5765beb2365", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  16%|        | 4/25 [00:20&lt;01:49,  5.19s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "39418825cf6f43fab4c1c85d398dc6c0", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  20%|        | 5/25 [00:25&lt;01:44,  5.22s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "973ca1b10fe545628ceb9de1e1ae267d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  24%|       | 6/25 [00:31&lt;01:38,  5.20s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "5a71e0c1322a4c6ba70f1ab586487d94", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  28%|       | 7/25 [00:36&lt;01:32,  5.15s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f433c6630164442cb592935e4429b5a6", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  32%|      | 8/25 [00:41&lt;01:26,  5.12s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ad5d0c349efb435bb6edf748c9aa1a44", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  36%|      | 9/25 [00:46&lt;01:22,  5.17s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "63d01d84219447c497e405654558ab52", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  40%|      | 10/25 [00:51&lt;01:18,  5.21s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6a3f0070264142a284a68b5bbfd9fd5c", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  44%|     | 11/25 [00:56&lt;01:10,  5.03s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c76ef05254f3404caa968ddcf66d9604", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  48%|     | 12/25 [01:01&lt;01:06,  5.09s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "2a19548c4df64215aa09decd9d2c889b", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  52%|    | 13/25 [01:07&lt;01:02,  5.21s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "085a945673ff44ba8cf774ecb2de60f0", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  56%|    | 14/25 [01:12&lt;00:57,  5.22s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "28b27a0a7190471c8600104ad19e6b73", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  60%|    | 15/25 [01:17&lt;00:52,  5.22s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "740d286713c147ff81b579f5edd51d81", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  64%|   | 16/25 [01:22&lt;00:45,  5.07s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "76a9a9720f3a4388bd8c653291224eb8", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  68%|   | 17/25 [01:27&lt;00:41,  5.15s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "455e24a10dc34c1c914ac6f37638874a", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  72%|  | 18/25 [01:31&lt;00:34,  4.86s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7ab414c35ac84127adcb876e6b985ea4", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  76%|  | 19/25 [01:36&lt;00:29,  4.95s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "8552cdb36ab948ccb3e47fed64efba0a", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  80%|  | 20/25 [01:41&lt;00:24,  4.91s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "cda7fc998bd542cea5b451eeaeac50c0", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  84%| | 21/25 [01:46&lt;00:19,  4.92s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "8256cf5b9257417f8ab5d4d4e06ea2b7", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  88%| | 22/25 [01:52&lt;00:15,  5.04s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "2cc52832b6ae4d7093e077101fe7eea7", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  92%|| 23/25 [01:55&lt;00:09,  4.52s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3a6ae7420d9e4cfca91cf3df52b2f416", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  96%|| 24/25 [02:00&lt;00:04,  4.69s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ae7881e5ec74441a83fd4debe2f76094", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...: 100%|| 25/25 [02:05&lt;00:00,  5.02s/it]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2371 tasks      | elapsed:    0.6s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    0.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
    finished (0:00:00) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:00) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 500/500: 100%|| 500/500 [01:28&lt;00:00,  5.62it/s, loss=-2.4e+03, v_num=1] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`Trainer.fit` stopped: `max_epochs=500` reached.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 500/500: 100%|| 500/500 [01:28&lt;00:00,  5.62it/s, loss=-2.4e+03, v_num=1]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Sampling from model<span class=" -Color -Color-Yellow">...</span>                                                                            
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2008 tasks      | elapsed:    1.6s
[Parallel(n_jobs=-1)]: Done 3597 tasks      | elapsed:    2.8s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    2.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   0%|          | 0/25 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "4c602154c3fe49eba74df3bf08db0dab", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   4%|         | 1/25 [00:05&lt;02:21,  5.90s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "869dca9b71b1403f857cf22dba3d9134", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   8%|         | 2/25 [00:12&lt;02:26,  6.36s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "19d886fa732945c5bdd91a374df4c26c", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  12%|        | 3/25 [00:18&lt;02:19,  6.33s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "36b2d01c1b6643ccbea4ea21fa495fe6", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  16%|        | 4/25 [00:25&lt;02:15,  6.47s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e5f0fd4e147b4b5282c46d10074524e9", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  20%|        | 5/25 [00:32&lt;02:09,  6.47s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6961ab6f83b74417ac5a0554405a05bf", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  24%|       | 6/25 [00:38&lt;02:04,  6.54s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "af0fc5fa0f2941879126398a475b2d60", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  28%|       | 7/25 [00:45&lt;01:58,  6.58s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3e1e3dda70d5414dbc7197d9460a34fe", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  32%|      | 8/25 [00:52&lt;01:52,  6.61s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "61f320d766104e71b9e2e64d9c85f30d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  36%|      | 9/25 [00:58&lt;01:45,  6.60s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9380ccedaee64818b30e340d0b8b4a20", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  40%|      | 10/25 [01:04&lt;01:37,  6.51s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7291171c5e454375ada3170fb2ecc107", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  44%|     | 11/25 [01:11&lt;01:29,  6.41s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b3d6af48cdc64687a32ebff95e2b90ac", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  48%|     | 12/25 [01:17&lt;01:22,  6.38s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "34da725105444113899abb1092b94a22", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  52%|    | 13/25 [01:21&lt;01:09,  5.80s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c3464262027b46fda2e7f22e113c39a6", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  56%|    | 14/25 [01:28&lt;01:05,  5.94s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a213546f87e340d4aaf53c994a20b60e", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  60%|    | 15/25 [01:34&lt;01:00,  6.01s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "263c853e73914f2e8b525775dabef3c4", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  64%|   | 16/25 [01:40&lt;00:54,  6.05s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "8d2e4719d3ec4050896b11cbe601e42e", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  68%|   | 17/25 [01:45&lt;00:46,  5.79s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "19fa1ce280e54391b418a63b027396a0", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  72%|  | 18/25 [01:51&lt;00:40,  5.80s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b571f43237de470ca417bec953629cdf", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  76%|  | 19/25 [01:55&lt;00:32,  5.41s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9b326bf18e464112b1e1aeb334de8ada", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  80%|  | 20/25 [02:01&lt;00:27,  5.54s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "74c9ed13967748a9aba4354c58f44765", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  84%| | 21/25 [02:07&lt;00:22,  5.64s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9506b166a8f24e28bd8855a541ce1203", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  88%| | 22/25 [02:14&lt;00:17,  5.87s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "cdce50ee216a47088f4236bec84d5600", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  92%|| 23/25 [02:20&lt;00:11,  5.96s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1fbfc9af2f5a420d9580be63c15325e6", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  96%|| 24/25 [02:26&lt;00:05,  5.92s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "17a0848155544ba1b72837249cea6196", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...: 100%|| 25/25 [02:30&lt;00:00,  6.02s/it]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2452 tasks      | elapsed:    0.6s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    0.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
    finished (0:00:00) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:00) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 345/500:  69%|   | 345/500 [01:01&lt;00:27,  5.64it/s, loss=-2.56e+03, v_num=1]
Monitored metric elbo_validation did not improve in the last 45 records. Best score: -2462.855. Signaling Trainer to stop.
<span class=" -Color -Color-Blue">INFO    </span> velovi: Sampling from model<span class=" -Color -Color-Yellow">...</span>                                                                            
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2008 tasks      | elapsed:    1.7s
[Parallel(n_jobs=-1)]: Done 3597 tasks      | elapsed:    2.9s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    3.0s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   0%|          | 0/25 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "2de6ebffb40545bba56892631bed3499", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   4%|         | 1/25 [00:06&lt;02:39,  6.63s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e245203edf28422e9cfb7d8dc3205c9e", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   8%|         | 2/25 [00:12&lt;02:27,  6.41s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "8c940138ea2f4e4785f80e2828610acf", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  12%|        | 3/25 [00:18&lt;02:12,  6.03s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "82dc0e1662d449c986e37f788ea028d9", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  16%|        | 4/25 [00:25&lt;02:10,  6.23s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c49927d126094d4a934f42240dde9857", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  20%|        | 5/25 [00:30&lt;02:02,  6.14s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "14ec941cb0b34c82926757ae43892316", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  24%|       | 6/25 [00:37&lt;02:00,  6.33s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "abe3179d084f41d7aa7d571b1a0c619d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  28%|       | 7/25 [00:44&lt;01:54,  6.38s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "faf1b04c6bd14fce899862a1d8c57b91", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  32%|      | 8/25 [00:50&lt;01:47,  6.30s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "024a3ec68efa4473b0275bdcaf9c8142", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  36%|      | 9/25 [00:56&lt;01:41,  6.33s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9b5d8bc9794a41c995e91578001a75fc", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  40%|      | 10/25 [01:03&lt;01:35,  6.36s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "42b9a1abed94434cb9f5ac0aaf510e52", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  44%|     | 11/25 [01:06&lt;01:18,  5.59s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "23d691c2328d4b02af29361bf377c14e", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  48%|     | 12/25 [01:13&lt;01:17,  5.98s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "bd729122f8a249809425b0527d321c32", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  52%|    | 13/25 [01:20&lt;01:14,  6.19s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7ea103ee89b340caad7d7e833f2e423a", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  56%|    | 14/25 [01:26&lt;01:07,  6.17s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "41cadb1d15c7411e94b4b7accbaff0bc", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  60%|    | 15/25 [01:32&lt;01:01,  6.20s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "cdd90d59a8de4134b0d5459ba1bfb5d1", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  64%|   | 16/25 [01:39&lt;00:56,  6.28s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a631513e2e0d4764b1b5312513cbd18c", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  68%|   | 17/25 [01:45&lt;00:50,  6.31s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "0db6348c82804bc888ae559d497690e9", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  72%|  | 18/25 [01:52&lt;00:44,  6.34s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "8e2f1d6645e14797b75da0ecd954d72b", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  76%|  | 19/25 [01:55&lt;00:33,  5.54s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "06660d89a46c4f3199f317f39219a59a", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  80%|  | 20/25 [02:01&lt;00:28,  5.71s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e10bd14bd04146af95bbdac0022afbb5", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  84%| | 21/25 [02:08&lt;00:24,  6.00s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "0c900fc150a647a3a98b7fadc9d530fa", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  88%| | 22/25 [02:15&lt;00:18,  6.17s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "627a8e86654d49ae8a6713e1eef9d18f", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  92%|| 23/25 [02:22&lt;00:12,  6.41s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3e927de725ba4d8f8bbab08d3bddd492", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  96%|| 24/25 [02:27&lt;00:06,  6.24s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "fd216dfdde5248509661dfcbb600942d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...: 100%|| 25/25 [02:34&lt;00:00,  6.17s/it]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2371 tasks      | elapsed:    0.6s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    0.8s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized count data: X, spliced, unspliced.
Logarithmized X.
computing neighbors
    finished (0:00:00) --&gt; added 
    &#39;distances&#39; and &#39;connectivities&#39;, weighted adjacency matrices (adata.obsp)
computing moments based on connectivities
    finished (0:00:00) --&gt; added 
    &#39;Ms&#39; and &#39;Mu&#39;, moments of un/spliced abundances (adata.layers)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 277/500:  55%|    | 277/500 [00:50&lt;00:40,  5.51it/s, loss=-3e+03, v_num=1]   
Monitored metric elbo_validation did not improve in the last 45 records. Best score: -2877.767. Signaling Trainer to stop.
<span class=" -Color -Color-Blue">INFO    </span> velovi: Sampling from model<span class=" -Color -Color-Yellow">...</span>                                                                            
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2008 tasks      | elapsed:    1.7s
[Parallel(n_jobs=-1)]: Done 3612 tasks      | elapsed:    2.9s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    2.9s finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   0%|          | 0/25 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f8b1eac782d64ca9b65b3299f2c1de83", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   4%|         | 1/25 [00:05&lt;02:12,  5.52s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "8d6c3651b1c94223b1b91b891195445d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:   8%|         | 2/25 [00:13&lt;02:37,  6.85s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "468195151d6e4674a22306a415cc64bf", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  12%|        | 3/25 [00:19&lt;02:25,  6.63s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7fbe374ad7b4415fb17685e10fc939f0", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  16%|        | 4/25 [00:27&lt;02:27,  7.04s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6de31f241b444520891f4ef225d12965", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  20%|        | 5/25 [00:35&lt;02:25,  7.27s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "4c814b2492624c42ab5dedcc4a92da4c", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  24%|       | 6/25 [00:42&lt;02:20,  7.37s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1cd372b8612a47809f2da2add68bdabb", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  28%|       | 7/25 [00:49&lt;02:11,  7.30s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "5a9fb03ddaf8421a9ce4149210743406", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  32%|      | 8/25 [00:57&lt;02:06,  7.47s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d772ebbc79db4a7bb4be865ecb4105d7", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  36%|      | 9/25 [01:05&lt;02:00,  7.54s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3fcaa135a6e54ad7bda774d7ebd07f61", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  40%|      | 10/25 [01:10&lt;01:44,  6.96s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "4c44555e7df846fab523af89c782cfa7", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  44%|     | 11/25 [01:18&lt;01:40,  7.18s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d63f1a3a63ea4541ae84d9e688f1832b", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  48%|     | 12/25 [01:26&lt;01:36,  7.40s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "0701807b761145a8980904d383bbb099", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  52%|    | 13/25 [01:33&lt;01:28,  7.41s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "408195edb531423ea219396ee33920c1", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  56%|    | 14/25 [01:39&lt;01:13,  6.72s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "73c69ef32af945a7b934c973854b4049", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  60%|    | 15/25 [01:47&lt;01:11,  7.15s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7c61b37c930845db877e74f8b82f5d69", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  64%|   | 16/25 [01:54&lt;01:03,  7.04s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "2f6f7e07c5c044ad818d6e3f9a83c100", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  68%|   | 17/25 [02:01&lt;00:57,  7.17s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e8198fa999e74e1fbfa1b0633e272e22", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  72%|  | 18/25 [02:09&lt;00:51,  7.38s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "cedad6298068468fab7ddf7e59a8df3d", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  76%|  | 19/25 [02:17&lt;00:44,  7.47s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c8f37e9d5f854ef39e2c8911eae751b4", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  80%|  | 20/25 [02:24&lt;00:37,  7.53s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f7229e39ab0040fc820c58a293d13dd2", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  84%| | 21/25 [02:32&lt;00:29,  7.48s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9b7982a50b8d487285e61f753bc19286", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  88%| | 22/25 [02:39&lt;00:22,  7.57s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "bb337aafcd554065a66252663e7df963", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  92%|| 23/25 [02:47&lt;00:15,  7.55s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ead6ef3f05c64c53a501010edc3f8f07", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...:  96%|| 24/25 [02:54&lt;00:07,  7.48s/it]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "494fb66bb44b49e8bb44097b3ca2e14c", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Working...: 100%|| 25/25 [03:02&lt;00:00,  7.29s/it]
<span class=" -Color -Color-Blue">INFO    </span> velovi: Computing the uncertainties<span class=" -Color -Color-Yellow">...</span>                                                                    
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 20 concurrent workers.
[Parallel(n_jobs=-1)]: Done 152 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 2398 tasks      | elapsed:    0.6s
[Parallel(n_jobs=-1)]: Done 3696 out of 3696 | elapsed:    0.9s finished
</pre></div>
</div>
</div>
</div>
<section id="id2">
<h3>Plot<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pairs</span><span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">)]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">with</span> <span class="n">mplscience</span><span class="o">.</span><span class="n">style_context</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;Noise scale&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;Uncertainty&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">uncertainty_full_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Type == &#39;Intrinsic&#39;&quot;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightblue&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Intrinsic Uncertainty&quot;</span><span class="p">)</span>
    <span class="c1"># annotator = Annotator(ax, pairs, data=df, x=x, y=y)</span>
    <span class="c1"># annotator.configure(test=&#39;Mann-Whitney&#39;, text_format=&#39;star&#39;, loc=&#39;inside&#39;)</span>
    <span class="c1"># annotator.apply_and_annotate()</span>

<span class="k">if</span> <span class="n">SAVE_FIGURES</span><span class="p">:</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="n">FIG_DIR</span> <span class="o">/</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="o">/</span> <span class="s1">&#39;pancreas_noise&#39;</span> <span class="o">/</span> <span class="s1">&#39;intrinsic_multiplicative.svg&#39;</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span>
        <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span>
    <span class="p">)</span>        

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">with</span> <span class="n">mplscience</span><span class="o">.</span><span class="n">style_context</span><span class="p">():</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">uncertainty_full_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Type == &#39;Extrinsic&#39;&quot;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgreen&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Extrinsic Uncertainty&quot;</span><span class="p">)</span>
        <span class="c1"># annotator = Annotator(ax, pairs, data=df, x=x, y=y)</span>
        <span class="c1"># annotator.configure(test=&#39;Mann-Whitney&#39;, text_format=&#39;star&#39;, loc=&#39;inside&#39;)</span>
        <span class="c1"># annotator.apply_and_annotate()</span>

<span class="k">if</span> <span class="n">SAVE_FIGURES</span><span class="p">:</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="n">FIG_DIR</span> <span class="o">/</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="o">/</span> <span class="s1">&#39;pancreas_noise&#39;</span> <span class="o">/</span> <span class="s1">&#39;extrinsic_multiplicative.svg&#39;</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span>
        <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span>
    <span class="p">)</span>            
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4501e3eaefae1a280d40a52d3dd082ce27c50dc1cd7a502d4d142c720b1e040e.png" src="../_images/4501e3eaefae1a280d40a52d3dd082ce27c50dc1cd7a502d4d142c720b1e040e.png" />
<img alt="../_images/7c82fdc87fdf868bde5dd800e19d5f1f479a2032e3abe00abdcf24f927d43204.png" src="../_images/7c82fdc87fdf868bde5dd800e19d5f1f479a2032e3abe00abdcf24f927d43204.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="s2">&quot;Sulf2&quot;</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="k">with</span> <span class="n">mplscience</span><span class="o">.</span><span class="n">style_context</span><span class="p">():</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ad</span><span class="p">),</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">perturbed_adatas</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">axarr</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
        <span class="n">scv</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ad</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Noise scale: </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="k">if</span> <span class="n">SAVE_FIGURES</span><span class="p">:</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="n">FIG_DIR</span> <span class="o">/</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="o">/</span> <span class="s1">&#39;pancreas_noise&#39;</span> <span class="o">/</span> <span class="s1">&#39;genes_multiplicative.svg&#39;</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span>
        <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span>
    <span class="p">)</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/26e4f7bea07b18235a775641b4d4ea996f5e5ca9a82ca570b6140948eee28bfc.png" src="../_images/26e4f7bea07b18235a775641b4d4ea996f5e5ca9a82ca570b6140948eee28bfc.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./uncertainty"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="pancreas.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Uncertainty analysis - Pancreas</p>
      </div>
    </a>
    <a class="right-next"
       href="../case_studies/dentategyrus.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Uncertainty analysis - Dentate gyrus</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#library-imports">Library imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-settings">General settings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#function-definition">Function definition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-loading">Data loading</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#umi-downsampling">UMI Downsampling</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot">Plot</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#unspliced-dropout">Unspliced dropout</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Plot</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiplicative-noise">Multiplicative noise</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Plot</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By VeloVI Team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
       Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>